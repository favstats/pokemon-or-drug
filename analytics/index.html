<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title> Overview â€“ PokÃ©mon or Drug - Game Analytics</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script src="site_libs/quarto-contrib/iconify-3.0.0/iconify-icon.min.js"></script>
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="">
<link href="https://fonts.googleapis.com/css2?family=Fira+Sans:wght@300;400;500;600;700&amp;family=Fira+Code:wght@300;400;500;600;700&amp;display=swap" rel="stylesheet">


<link rel="stylesheet" href="assets/modal.css">
<link rel="stylesheet" href="assets/pagination.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">PokÃ©mon or Drug - Game Analytics</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link active" href="./index.html" aria-current="page"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./games_over_time.html"> 
<span class="menu-text"><iconify-icon role="img" inline="" icon="ph:chart-line" aria-label="Icon chart-line from ph Iconify.design set." title="Icon chart-line from ph Iconify.design set."></iconify-icon> Games Over Time</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./league_analysis.html"> 
<span class="menu-text"><iconify-icon role="img" inline="" icon="ph:trophy" aria-label="Icon trophy from ph Iconify.design set." title="Icon trophy from ph Iconify.design set."></iconify-icon> League Analysis</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/favstats/pokemon-or-drug"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/favstats"> <i class="bi bi-twitter" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content column-page" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title"><iconify-icon role="img" inline="" icon="ph:house" aria-label="Icon house from ph Iconify.design set." title="Icon house from ph Iconify.design set."></iconify-icon> Overview</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
</div>



<div class="quarto-title-meta column-page">

    
  
    
  </div>
  


</header>


<style>
/* Ensure chart containers expand to fit content - aggressive overrides */
.cell-output-display,
.cell-output,
.panel-tabset-tabby > .tab-content,
.panel-tabset > .tab-content,
.tab-pane,
.tab-pane.active,
.card-body,
.quarto-figure,
section {
  overflow: visible !important;
  height: auto !important;
  max-height: none !important;
}
/* Ensure highcharts containers respect their set height */
.highcharts-container,
.html-widget,
.htmlwidget {
  overflow: visible !important;
}
</style>
<script>
// Aggressive reflow for Highcharts - multiple attempts to catch widget initialization
(function() {
  function reflowCharts() {
    if (typeof Highcharts !== 'undefined' && Highcharts.charts) {
      Highcharts.charts.forEach(function(chart) {
        if (chart) {
          try { chart.reflow(); } catch(e) {}
        }
      });
    }
  }
  
  // Try multiple times at different intervals
  [0, 100, 250, 500, 1000, 2000].forEach(function(delay) {
    setTimeout(function() {
      window.dispatchEvent(new Event('resize'));
      requestAnimationFrame(reflowCharts);
    }, delay);
  });
  
  // Also reflow on any tab click
  document.addEventListener('click', function(e) {
    if (e.target.matches('.nav-link, [data-bs-toggle="tab"]')) {
      setTimeout(reflowCharts, 50);
    }
  });
})();
</script>
<!-- Premium Libraries -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
<script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns@3.0.0/dist/chartjs-adapter-date-fns.bundle.min.js"></script>

<style>
  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }

  body {
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    background: #fafbfc;
    color: #1a1a2e;
    line-height: 1.6;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    margin: 0;
    padding: 0;
  }

  .dashboard-wrapper {
    display: flex;
    min-height: 100vh;
  }

  /* Sidebar */
  .sidebar {
    width: 280px;
    background: white;
    border-right: 1px solid #e5e7eb;
    padding: 2rem 0;
    position: fixed;
    height: 100vh;
    overflow-y: auto;
    z-index: 100;
  }

  .sidebar-header {
    padding: 0 1.5rem 2rem;
    border-bottom: 1px solid #e5e7eb;
    margin-bottom: 1.5rem;
  }

  .sidebar-title {
    font-family: 'Space Grotesk', sans-serif;
    font-size: 1.5rem;
    font-weight: 700;
    color: #0a0a0f;
    margin-bottom: 0.25rem;
  }

  .sidebar-subtitle {
    font-size: 0.875rem;
    color: #6b7280;
  }

  .sidebar-nav {
    padding: 0 1rem;
  }

  .nav-item {
    padding: 0.75rem 1rem;
    margin-bottom: 0.25rem;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.2s ease;
    display: flex;
    align-items: center;
    gap: 0.75rem;
    color: #374151;
    font-weight: 500;
    font-size: 0.9375rem;
  }

  .nav-item:hover {
    background: #f3f4f6;
    color: #0a0a0f;
  }

  .nav-item.active {
    background: #eff6ff;
    color: #3b82f6;
    font-weight: 600;
  }

  .nav-icon {
    font-size: 1.125rem;
    width: 24px;
    text-align: center;
    color: inherit;
  }

  /* Main Content */
  .main-content {
    flex: 1;
    margin-left: 280px;
    padding: 2rem 3rem;
    max-width: calc(100vw - 280px);
  }

  .content-header {
    margin-bottom: 2rem;
  }

  .content-title {
    font-family: 'Space Grotesk', sans-serif;
    font-size: 2rem;
    font-weight: 700;
    color: #0a0a0f;
    margin-bottom: 0.5rem;
  }

  .content-description {
    color: #6b7280;
    font-size: 0.9375rem;
  }

  .dashboard-container {
    width: 100%;
  }

  .dashboard-header {
    margin-bottom: 3rem;
  }

  .dashboard-title {
    font-family: 'Space Grotesk', sans-serif;
    font-size: 2.75rem;
    font-weight: 700;
    color: #0a0a0f;
    margin-bottom: 0.5rem;
    letter-spacing: -0.02em;
  }

  .dashboard-subtitle {
    font-size: 1rem;
    color: #6b7280;
    font-weight: 400;
    margin-bottom: 1rem;
  }

  .last-updated {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.875rem;
    color: #9ca3af;
    padding: 0.5rem 1rem;
    background: #f3f4f6;
    border-radius: 8px;
    border: 1px solid #e5e7eb;
  }

  .stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    gap: 1.25rem;
    margin-bottom: 2rem;
  }

  .stat-card {
    background: white;
    border-radius: 16px;
    padding: 1.75rem;
    border: 1px solid #e5e7eb;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
    transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
    overflow: hidden;
  }

  .stat-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 3px;
    background: linear-gradient(90deg, #3b82f6, #8b5cf6);
    transform: scaleX(0);
    transform-origin: left;
    transition: transform 0.3s ease;
  }

  .stat-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
    border-color: #d1d5db;
  }

  .stat-card:hover::before {
    transform: scaleX(1);
  }

  .stat-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 1rem;
  }

  .stat-icon-wrapper {
    width: 48px;
    height: 48px;
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.25rem;
    background: #f3f4f6;
    color: #374151;
  }

  .stat-card:nth-child(1) .stat-icon-wrapper { background: #dbeafe; color: #1e40af; }
  .stat-card:nth-child(2) .stat-icon-wrapper { background: #fce7f3; color: #be185d; }
  .stat-card:nth-child(3) .stat-icon-wrapper { background: #fef3c7; color: #d97706; }
  .stat-card:nth-child(4) .stat-icon-wrapper { background: #d1fae5; color: #059669; }

  .stat-label {
    font-size: 0.8125rem;
    color: #6b7280;
    font-weight: 500;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    margin-bottom: 0.5rem;
  }

  .stat-value {
    font-size: 2rem;
    font-weight: 700;
    color: #0a0a0f;
    line-height: 1;
    font-variant-numeric: tabular-nums;
  }

  .filters-bar {
    display: flex;
    gap: 1rem;
    margin-bottom: 2rem;
    flex-wrap: wrap;
    align-items: center;
    padding: 1.25rem;
    background: white;
    border-radius: 12px;
    border: 1px solid #e5e7eb;
    box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
  }

  .view-content {
    display: none;
  }

  .view-content.active {
    display: block;
    animation: fadeIn 0.3s ease;
  }

  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
  }

  .insight-card {
    background: white;
    border-radius: 12px;
    padding: 1.5rem;
    border: 1px solid #e5e7eb;
    margin-bottom: 1rem;
  }

  .insight-title {
    font-weight: 600;
    color: #0a0a0f;
    margin-bottom: 0.75rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  .insight-text {
    color: #6b7280;
    font-size: 0.9375rem;
    line-height: 1.6;
  }

  .tooltip-trigger {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 18px;
    height: 18px;
    border-radius: 50%;
    background: #e5e7eb;
    color: #6b7280;
    font-size: 0.75rem;
    cursor: help;
    margin-left: 0.25rem;
    position: relative;
  }

  .tooltip-trigger:hover .tooltip {
    opacity: 1;
    visibility: visible;
  }

  .tooltip {
    position: absolute;
    bottom: 100%;
    left: 50%;
    transform: translateX(-50%);
    margin-bottom: 8px;
    padding: 0.75rem 1rem;
    background: #1f2937;
    color: white;
    font-size: 0.8125rem;
    border-radius: 8px;
    white-space: nowrap;
    opacity: 0;
    visibility: hidden;
    transition: all 0.2s ease;
    z-index: 1000;
    pointer-events: none;
    max-width: 250px;
    white-space: normal;
  }

  .tooltip::after {
    content: '';
    position: absolute;
    top: 100%;
    left: 50%;
    transform: translateX(-50%);
    border: 6px solid transparent;
    border-top-color: #1f2937;
  }

  .filter-group {
    display: flex;
    align-items: center;
    gap: 0.75rem;
  }

  .filter-label {
    font-size: 0.875rem;
    color: #374151;
    font-weight: 500;
  }

  .filter-select {
    background: white;
    border: 1px solid #d1d5db;
    border-radius: 8px;
    padding: 0.5rem 1rem;
    color: #1a1a2e;
    font-size: 0.875rem;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s ease;
    outline: none;
    min-width: 140px;
  }

  .filter-select:hover {
    border-color: #9ca3af;
  }

  .filter-select:focus {
    border-color: #3b82f6;
    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
  }

  .grid-2 {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
    gap: 1.5rem;
    margin-bottom: 1.5rem;
  }

  .grid-full {
    grid-column: 1 / -1;
  }

  .chart-card {
    background: white;
    border-radius: 16px;
    padding: 1.75rem;
    border: 1px solid #e5e7eb;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
    transition: all 0.2s ease;
  }

  .chart-card:hover {
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
  }

  .chart-title {
    font-size: 1.125rem;
    font-weight: 600;
    color: #0a0a0f;
    margin-bottom: 1.5rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-family: 'Space Grotesk', sans-serif;
  }

  .chart-title-icon {
    font-size: 1.25rem;
  }

  .chart-container {
    position: relative;
    width: 100%;
    min-height: 350px;
  }

  .loading-spinner {
    display: inline-block;
    width: 16px;
    height: 16px;
    border: 2px solid #e5e7eb;
    border-radius: 50%;
    border-top-color: #3b82f6;
    animation: spin 0.8s linear infinite;
  }

  @keyframes spin {
    to { transform: rotate(360deg); }
  }

  @media (max-width: 768px) {
    .dashboard-container {
      padding: 1.5rem 1rem;
    }
    .dashboard-title {
      font-size: 2rem;
    }
    .stats-grid {
      grid-template-columns: 1fr;
    }
    .grid-2 {
      grid-template-columns: 1fr;
    }
  }
</style>

<section id="pokÃ©mon-or-drug---game-analytics" class="level1">
<div class="dashboard-wrapper">
  <!-- Sidebar Navigation -->
  <aside class="sidebar">
    <div class="sidebar-header">
      <h1 class="sidebar-title">Analytics</h1>
      <p class="sidebar-subtitle">Game Insights</p>
    </div>
    <nav class="sidebar-nav">
      <div class="nav-item active" data-view="overview">
        <span class="nav-icon"><i class="fas fa-chart-bar"></i></span>
        <span>Overview</span>
      </div>
      <div class="nav-item" data-view="users">
        <span class="nav-icon"><i class="fas fa-users"></i></span>
        <span>Users Over Time</span>
      </div>
      <div class="nav-item" data-view="leagues">
        <span class="nav-icon"><i class="fas fa-trophy"></i></span>
        <span>League Analysis</span>
      </div>
      <div class="nav-item" data-view="performance">
        <span class="nav-icon"><i class="fas fa-chart-line"></i></span>
        <span>Performance</span>
      </div>
      <div class="nav-item" data-view="patterns">
        <span class="nav-icon"><i class="fas fa-clock"></i></span>
        <span>Time Patterns</span>
      </div>
      <div class="nav-item" data-view="insights">
        <span class="nav-icon"><i class="fas fa-lightbulb"></i></span>
        <span>Key Insights</span>
      </div>
    </nav>
    <div style="padding: 1.5rem 1rem; border-top: 1px solid #e5e7eb; margin-top: 1.5rem;">
      <div style="font-size: 0.8125rem; color: #9ca3af;" id="sidebar-last-updated">Loading...</div>
    </div>
  </aside>

  <!-- Main Content Area -->
  <main class="main-content">
    <!-- Overview View -->
    <div class="view-content active" id="view-overview">
      <div class="content-header">
        <h2 class="content-title">Overview</h2>
        <p class="content-description">Key metrics and performance indicators</p>
      </div>
      <div class="dashboard-container">

  <!-- Summary Stats -->
  <div class="stats-grid" id="summary-cards">
          <div class="stat-card">
            <div class="stat-header">
              <div>
                <div class="stat-label">Total Games</div>
                <div class="stat-value" id="metric-total-games">-</div>
              </div>
              <div class="stat-icon-wrapper"><i class="fas fa-gamepad"></i></div>
            </div>
          </div>
          <div class="stat-card">
            <div class="stat-header">
              <div>
                <div class="stat-label">Unique Players</div>
                <div class="stat-value" id="metric-unique-players">-</div>
              </div>
              <div class="stat-icon-wrapper"><i class="fas fa-users"></i></div>
            </div>
          </div>
          <div class="stat-card">
            <div class="stat-header">
              <div>
                <div class="stat-label">Average Score</div>
                <div class="stat-value" id="metric-avg-score">-</div>
              </div>
              <div class="stat-icon-wrapper"><i class="fas fa-trophy"></i></div>
            </div>
          </div>
          <div class="stat-card">
            <div class="stat-header">
              <div>
                <div class="stat-label">Average Accuracy</div>
                <div class="stat-value" id="metric-avg-accuracy">-</div>
              </div>
              <div class="stat-icon-wrapper"><i class="fas fa-bullseye"></i></div>
            </div>
          </div>
  </div>

  <!-- Interactive Filters -->
  <div class="filters-bar">
    <div class="filter-group">
      <span class="filter-label">League</span>
      <select class="filter-select" id="filter-league">
        <option value="all">All Leagues</option>
        <option value="boulder">Boulder</option>
        <option value="cascade">Cascade</option>
        <option value="volcano">Volcano</option>
        <option value="earth">Earth</option>
        <option value="custom">Custom</option>
      </select>
    </div>
    <div class="filter-group">
      <span class="filter-label">Time Range</span>
      <select class="filter-select" id="filter-time">
        <option value="all">All Time</option>
        <option value="24h">Last 24 Hours</option>
        <option value="7d">Last 7 Days</option>
        <option value="30d">Last 30 Days</option>
      </select>
    </div>
  </div>

        <!-- Overview content will be populated here -->
      </div>
    </div>

    <!-- Users Over Time View -->
    <div class="view-content" id="view-users">
      <div class="content-header">
        <h2 class="content-title">Users Over Time</h2>
        <p class="content-description">Track unique user engagement patterns throughout the day</p>
      </div>
      <div class="dashboard-container">
        <div class="chart-card grid-full">
          <h3 class="chart-title">
            <span class="chart-title-icon"><i class="fas fa-users"></i></span>
            Unique Users Per Hour
            <span class="tooltip-trigger"><i class="fas fa-info-circle"></i>
              <span class="tooltip">Shows the number of unique players active in each hour. Helps identify peak engagement times.</span>
            </span>
          </h3>
          <div class="chart-container" id="usersOverTimeChart"></div>
        </div>
        <div class="grid-2">
          <div class="chart-card">
            <h3 class="chart-title">
              <span class="chart-title-icon"><i class="fas fa-user-friends"></i></span>
              New vs Returning Users
            </h3>
            <div class="chart-container">
              <canvas id="newReturningUsersChart"></canvas>
            </div>
          </div>
          <div class="chart-card">
            <h3 class="chart-title">
              <span class="chart-title-icon"><i class="fas fa-chart-pie"></i></span>
              User Engagement Distribution
            </h3>
            <div class="chart-container">
              <canvas id="userEngagementChart"></canvas>
            </div>
          </div>
        </div>
        <div class="chart-card grid-full">
          <h3 class="chart-title">
            <span class="chart-title-icon"><i class="fas fa-calendar-alt"></i></span>
            Daily Active Users Trend
          </h3>
          <div class="chart-container" id="dailyActiveUsersChart"></div>
        </div>
        <div class="insight-card" id="users-insight">
          <div class="insight-title"><i class="fas fa-lightbulb"></i> Analysis</div>
          <div class="insight-text">Loading insights...</div>
        </div>
      </div>
    </div>

    <!-- League Analysis View -->
    <div class="view-content" id="view-leagues">
      <div class="content-header">
        <h2 class="content-title">League Analysis</h2>
        <p class="content-description">Compare performance across different leagues</p>
      </div>
      <div class="dashboard-container">
        <div class="chart-card grid-full">
          <h3 class="chart-title">
            <span class="chart-title-icon"><i class="fas fa-chart-area"></i></span>
            Games Per League Over Time
          </h3>
          <div class="chart-container" id="leagueOverTimeChart"></div>
        </div>
        <div class="grid-2">
          <div class="chart-card">
            <h3 class="chart-title">
              <span class="chart-title-icon"><i class="fas fa-trophy"></i></span>
              League Distribution
            </h3>
            <div class="chart-container">
              <canvas id="leagueDistributionChart"></canvas>
            </div>
          </div>
          <div class="chart-card">
            <h3 class="chart-title">
              <span class="chart-title-icon"><i class="fas fa-users"></i></span>
              Players per League
            </h3>
            <div class="chart-container">
              <canvas id="playersPerLeagueChart"></canvas>
            </div>
          </div>
        </div>
        <div class="chart-card">
          <h3 class="chart-title">
            <span class="chart-title-icon"><i class="fas fa-chart-bar"></i></span>
            League Performance Comparison
          </h3>
          <div class="chart-container">
            <canvas id="leagueMetricsChart"></canvas>
          </div>
        </div>
        <div class="grid-2">
          <div class="chart-card">
            <h3 class="chart-title">
              <span class="chart-title-icon"><i class="fas fa-chart-line"></i></span>
              Average Score Trend by League
            </h3>
            <div class="chart-container" id="leagueScoreTrendChart"></div>
          </div>
          <div class="chart-card">
            <h3 class="chart-title">
              <span class="chart-title-icon"><i class="fas fa-bullseye"></i></span>
              Average Accuracy Trend by League
            </h3>
            <div class="chart-container" id="leagueAccuracyTrendChart"></div>
          </div>
        </div>
        <div class="insight-card" id="leagues-insight">
          <div class="insight-title"><i class="fas fa-lightbulb"></i> Analysis</div>
          <div class="insight-text">Loading insights...</div>
        </div>
      </div>
    </div>

    <!-- Performance View -->
    <div class="view-content" id="view-performance">
      <div class="content-header">
        <h2 class="content-title">Performance Analysis</h2>
        <p class="content-description">Score and accuracy relationships</p>
      </div>
      <div class="dashboard-container">
        <div class="chart-card grid-full">
          <h3 class="chart-title">
            <span class="chart-title-icon"><i class="fas fa-chart-scatter"></i></span>
            Score vs Accuracy Correlation
            <span class="tooltip-trigger"><i class="fas fa-info-circle"></i>
              <span class="tooltip">Each point represents a game. Higher accuracy generally correlates with higher scores. Points are colored by league.</span>
            </span>
          </h3>
          <div class="chart-container" id="scoreAccuracyChart"></div>
        </div>
        <div class="grid-2">
          <div class="chart-card">
            <h3 class="chart-title">
              <span class="chart-title-icon"><i class="fas fa-chart-bar"></i></span>
              Score Distribution by League
            </h3>
            <div class="chart-container">
              <canvas id="scoreDistributionChart"></canvas>
            </div>
          </div>
          <div class="chart-card">
            <h3 class="chart-title">
              <span class="chart-title-icon"><i class="fas fa-bullseye"></i></span>
              Accuracy Distribution by League
            </h3>
            <div class="chart-container">
              <canvas id="accuracyDistributionChart"></canvas>
            </div>
          </div>
        </div>
        <div class="chart-card grid-full">
          <h3 class="chart-title">
            <span class="chart-title-icon"><i class="fas fa-chart-line"></i></span>
            Score Trends Over Time
          </h3>
          <div class="chart-container" id="scoreTrendChart"></div>
        </div>
        <div class="grid-2">
          <div class="chart-card">
            <h3 class="chart-title">
              <span class="chart-title-icon"><i class="fas fa-chart-area"></i></span>
              Score Histogram
            </h3>
            <div class="chart-container">
              <canvas id="scoreHistogramChart"></canvas>
            </div>
          </div>
          <div class="chart-card">
            <h3 class="chart-title">
              <span class="chart-title-icon"><i class="fas fa-chart-area"></i></span>
              Accuracy Histogram
            </h3>
            <div class="chart-container">
              <canvas id="accuracyHistogramChart"></canvas>
            </div>
          </div>
        </div>
        <div class="chart-card grid-full">
          <h3 class="chart-title">
            <span class="chart-title-icon"><i class="fas fa-chart-scatter"></i></span>
            Score vs Games Played (Player Progression)
          </h3>
          <div class="chart-container" id="playerProgressionChart"></div>
        </div>
        <div class="insight-card" id="performance-insight">
          <div class="insight-title"><i class="fas fa-lightbulb"></i> Analysis</div>
          <div class="insight-text">Loading insights...</div>
        </div>
      </div>
    </div>

    <!-- Time Patterns View -->
    <div class="view-content" id="view-patterns">
      <div class="content-header">
        <h2 class="content-title">Time Patterns</h2>
        <p class="content-description">When do players engage most?</p>
      </div>
      <div class="dashboard-container">
        <div class="chart-card grid-full">
          <h3 class="chart-title">
            <span class="chart-title-icon"><i class="fas fa-calendar-day"></i></span>
            Daily Game Trends
          </h3>
          <div class="chart-container" id="gamesPerDayChart"></div>
        </div>
        <div class="grid-2">
          <div class="chart-card">
            <h3 class="chart-title">
              <span class="chart-title-icon"><i class="fas fa-clock"></i></span>
              Games by Hour of Day
            </h3>
            <div class="chart-container">
              <canvas id="hourDistributionChart"></canvas>
            </div>
          </div>
          <div class="chart-card">
            <h3 class="chart-title">
              <span class="chart-title-icon"><i class="fas fa-calendar-week"></i></span>
              Games by Day of Week
            </h3>
            <div class="chart-container">
              <canvas id="dayOfWeekChart"></canvas>
            </div>
          </div>
        </div>
        <div class="chart-card grid-full">
          <h3 class="chart-title">
            <span class="chart-title-icon"><i class="fas fa-th"></i></span>
            Heatmap: Games by Hour and Day of Week
          </h3>
          <div class="chart-container" id="hourDayHeatmapChart"></div>
        </div>
        <div class="grid-2">
          <div class="chart-card">
            <h3 class="chart-title">
              <span class="chart-title-icon"><i class="fas fa-chart-line"></i></span>
              Average Score by Hour
            </h3>
            <div class="chart-container">
              <canvas id="scoreByHourChart"></canvas>
            </div>
          </div>
          <div class="chart-card">
            <h3 class="chart-title">
              <span class="chart-title-icon"><i class="fas fa-chart-line"></i></span>
              Average Score by Day of Week
            </h3>
            <div class="chart-container">
              <canvas id="scoreByDayChart"></canvas>
            </div>
          </div>
        </div>
        <div class="chart-card grid-full">
          <h3 class="chart-title">
            <span class="chart-title-icon"><i class="fas fa-chart-area"></i></span>
            Weekly Activity Pattern
          </h3>
          <div class="chart-container" id="weeklyPatternChart"></div>
        </div>
        <div class="insight-card" id="patterns-insight">
          <div class="insight-title"><i class="fas fa-lightbulb"></i> Analysis</div>
          <div class="insight-text">Loading insights...</div>
        </div>
      </div>
    </div>

    <!-- Key Insights View -->
    <div class="view-content" id="view-insights">
      <div class="content-header">
        <h2 class="content-title">Key Insights</h2>
        <p class="content-description">Automated analysis and recommendations</p>
      </div>
      <div class="dashboard-container">
        <div class="insight-card" id="key-insights">
          <div class="insight-title"><i class="fas fa-search"></i> Comprehensive Analysis</div>
          <div class="insight-text">Loading comprehensive insights...</div>
        </div>
      </div>
    </div>
  </main>
</div>
</section>
<style>
  .card {
    transition: transform 0.2s, box-shadow 0.2s;
  }
  .card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.1) !important;
  }
  #summary-cards .card {
    border-radius: 8px;
  }
  .card-header {
    border-bottom: 2px solid #f0f0f0;
    font-weight: 600;
  }
  canvas {
    max-height: 400px;
  }
</style>

<script>
// ðŸš€ STUNNING MODERN DASHBOARD - PokÃ©mon or Drug Analytics
// Beautiful, interactive, and fully responsive with Plotly.js & Chart.js

(function() {
  const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQKvOHhK-Rw71DILu_X0ydZCS86KF2TeCyLrNAQx_MQsQN0mIPEteIO_V86DUerFO_JpwZmieGXLW-P/pub?gid=923170622&single=true&output=csv";
  
  // Global state
  let allData = [];
  let filteredData = [];
  let charts = {};
  
  // Premium color palette
  const colors = {
    boulder: '#92400e',
    cascade: '#1e40af',
    volcano: '#dc2626',
    earth: '#059669',
    custom: '#7c3aed',
    primary: '#3b82f6',
    secondary: '#8b5cf6',
    success: '#10b981',
    danger: '#ef4444'
  };
  
  // Plotly theme - clean and professional
  const plotlyTheme = {
    paper_bgcolor: 'rgba(0,0,0,0)',
    plot_bgcolor: 'rgba(0,0,0,0)',
    font: { 
      family: 'Inter, -apple-system, sans-serif', 
      color: '#374151', 
      size: 12 
    },
    hovermode: 'closest',
    showlegend: true,
    legend: {
      bgcolor: 'rgba(255,255,255,0.95)',
      bordercolor: '#e5e7eb',
      borderwidth: 1,
      font: { size: 11, color: '#6b7280' },
      x: 0.02,
      y: 0.98,
      xanchor: 'left',
      yanchor: 'top'
    },
    margin: { l: 60, r: 30, t: 20, b: 60 },
    xaxis: {
      gridcolor: '#f3f4f6',
      gridwidth: 1,
      zeroline: false,
      linecolor: '#e5e7eb',
      linewidth: 1
    },
    yaxis: {
      gridcolor: '#f3f4f6',
      gridwidth: 1,
      zeroline: false,
      linecolor: '#e5e7eb',
      linewidth: 1
    }
  };
  
  // Enhanced CSV parser - don't filter out rows, just parse them
  function parseCSV(text) {
    const lines = text.split("\n").filter(line => line.trim());
    if (lines.length === 0) return [];
    
    const headers = lines[0].split(",").map(h => h.trim().replace(/^"|"$/g, ''));
    const parsed = lines.slice(1).map(line => {
      const values = [];
      let current = '';
      let inQuotes = false;
      
      for (let i = 0; i < line.length; i++) {
        const char = line[i];
        if (char === '"') {
          inQuotes = !inQuotes;
        } else if (char === ',' && !inQuotes) {
          values.push(current.trim());
          current = '';
        } else {
          current += char;
        }
      }
      values.push(current.trim());
      
      const obj = {};
      headers.forEach((header, i) => {
        let value = (values[i] || "").replace(/^"|"$/g, '').trim();
        if (value && !isNaN(value) && value !== "" && value !== "null") {
          const num = parseFloat(value);
          obj[header] = !isNaN(num) ? num : value;
        } else {
          obj[header] = value || null;
        }
      });
      return obj;
    });
    
    // Log parsing stats
    const totalRows = parsed.length;
    const rowsWithDate = parsed.filter(row => row.Date).length;
    const rowsWithLeague = parsed.filter(row => row.League).length;
    const rowsWithBoth = parsed.filter(row => row.Date && row.League).length;
    
    console.log(`ðŸ“Š CSV Parsing Stats:
      Total rows parsed: ${totalRows}
      Rows with Date: ${rowsWithDate}
      Rows with League: ${rowsWithLeague}
      Rows with both: ${rowsWithBoth}
      Rows missing Date: ${totalRows - rowsWithDate}
      Rows missing League: ${totalRows - rowsWithLeague}
    `);
    
    // Return all rows - let the individual chart functions handle missing data
    return parsed;
  }
  
  // Filter data based on filters
  function filterData(data) {
    let filtered = [...data];
    const leagueFilter = document.getElementById('filter-league')?.value;
    const timeFilter = document.getElementById('filter-time')?.value;
    
    if (leagueFilter && leagueFilter !== 'all') {
      filtered = filtered.filter(row => 
        String(row.League || '').toLowerCase() === leagueFilter.toLowerCase()
      );
    }
    
    if (timeFilter && timeFilter !== 'all') {
      const now = new Date();
      const cutoff = new Date();
      if (timeFilter === '24h') cutoff.setHours(now.getHours() - 24);
      else if (timeFilter === '7d') cutoff.setDate(now.getDate() - 7);
      else if (timeFilter === '30d') cutoff.setDate(now.getDate() - 30);
      
      filtered = filtered.filter(row => {
        const dateInfo = parseDate(row.Date);
        return dateInfo && dateInfo.date >= cutoff;
      });
    }
    
    return filtered;
  }
  
  // Process date
  function parseDate(dateStr) {
    if (!dateStr) return null;
    const date = new Date(dateStr);
    if (isNaN(date.getTime())) return null;
    return {
      date: date,
      timestamp: date.getTime(),
      dateOnly: date.toISOString().split("T")[0],
      hour: date.getHours(),
      weekday: date.toLocaleDateString("en-US", { weekday: "long" }),
      dayOfWeek: date.getDay()
    };
  }
  
  // Update summary metrics - use ALL data, not filtered
  function updateSummaryMetrics(data) {
    // Use allData for total count, filteredData for filtered metrics
    const totalGames = allData.length; // Show total from all data
    const uniquePlayers = new Set(allData.map(d => d.Name).filter(Boolean)).size;
    
    // For averages, use filtered data if available, otherwise all data
    const dataForAverages = filteredData.length > 0 ? filteredData : allData;
    const scores = dataForAverages.map(d => d.Score || 0).filter(s => s > 0);
    const accuracies = dataForAverages.map(d => d.Accuracy || 0).filter(a => a > 0);
    
    const avgScore = scores.length > 0 ? Math.round(scores.reduce((a, b) => a + b, 0) / scores.length) : 0;
    const avgAccuracy = accuracies.length > 0 ? (accuracies.reduce((a, b) => a + b, 0) / accuracies.length).toFixed(1) : 0;
    
    document.getElementById('metric-total-games').textContent = totalGames.toLocaleString();
    document.getElementById('metric-unique-players').textContent = uniquePlayers.toLocaleString();
    document.getElementById('metric-avg-score').textContent = avgScore.toLocaleString();
    document.getElementById('metric-avg-accuracy').textContent = avgAccuracy + '%';
    
    console.log(`ðŸ“ˆ Summary Metrics:
      Total Games: ${totalGames}
      Unique Players: ${uniquePlayers}
      Avg Score: ${avgScore}
      Avg Accuracy: ${avgAccuracy}%
      Filtered Games: ${filteredData.length}
    `);
  }
  
  // Update last updated timestamp
  function updateLastUpdatedTimestamp() {
    const now = new Date();
    const formatted = now.toLocaleString("en-US", {
      year: "numeric",
      month: "short",
      day: "numeric",
      hour: "2-digit",
      minute: "2-digit",
      timeZoneName: "short"
    });
    const sidebarEl = document.getElementById('sidebar-last-updated');
    if (sidebarEl) sidebarEl.textContent = `Updated ${formatted}`;
  }

  // Navigation handling
  function setupNavigation() {
    const navItems = document.querySelectorAll('.nav-item');
    const views = document.querySelectorAll('.view-content');

    navItems.forEach(item => {
      item.addEventListener('click', () => {
        const viewId = item.dataset.view;
        
        // Update active states
        navItems.forEach(nav => nav.classList.remove('active'));
        item.classList.add('active');
        
        // Show selected view
        views.forEach(view => view.classList.remove('active'));
        const targetView = document.getElementById(`view-${viewId}`);
        if (targetView) targetView.classList.add('active');
      });
    });
  }

  // Generate insights
  function generateInsights(data) {
    const insights = {
      users: generateUsersInsights(data),
      leagues: generateLeaguesInsights(data),
      performance: generatePerformanceInsights(data),
      patterns: generatePatternsInsights(data),
      key: generateKeyInsights(data)
    };
    
    Object.keys(insights).forEach(key => {
      const el = document.getElementById(`${key}-insight`);
      if (el) {
        const textEl = el.querySelector('.insight-text');
        if (textEl) textEl.innerHTML = insights[key];
      }
    });
  }

  function generateUsersInsights(data) {
    const hourlyUsers = {};
    const dailyUsers = {};
    const userGameCounts = {};
    
    data.forEach(row => {
      const dateInfo = parseDate(row.Date);
      if (!dateInfo) return;
      
      // Hourly
      const hour = dateInfo.hour;
      if (!hourlyUsers[hour]) hourlyUsers[hour] = new Set();
      if (row.Name) hourlyUsers[hour].add(row.Name);
      
      // Daily
      const day = dateInfo.dateOnly;
      if (!dailyUsers[day]) dailyUsers[day] = new Set();
      if (row.Name) dailyUsers[day].add(row.Name);
      
      // Per user
      if (row.Name) {
        userGameCounts[row.Name] = (userGameCounts[row.Name] || 0) + 1;
      }
    });
    
    const peakHour = Object.keys(hourlyUsers).reduce((a, b) => 
      hourlyUsers[a].size > hourlyUsers[b].size ? a : b
    );
    const peakCount = hourlyUsers[peakHour].size;
    
    const quietHour = Object.keys(hourlyUsers).reduce((a, b) => 
      hourlyUsers[a].size < hourlyUsers[b].size ? a : b
    );
    const quietCount = hourlyUsers[quietHour].size;
    
    // Daily trends
    const sortedDays = Object.keys(dailyUsers).sort();
    const dailyCounts = sortedDays.map(d => dailyUsers[d].size);
    const avgDailyUsers = dailyCounts.length > 0 ? 
      Math.round(dailyCounts.reduce((a, b) => a + b, 0) / dailyCounts.length) : 0;
    const maxDailyUsers = Math.max(...dailyCounts, 0);
    const minDailyUsers = Math.min(...dailyCounts, 0);
    
    // User engagement
    const gameCounts = Object.values(userGameCounts);
    const avgGamesPerUser = gameCounts.length > 0 ? 
      (gameCounts.reduce((a, b) => a + b, 0) / gameCounts.length).toFixed(1) : 0;
    const maxGames = Math.max(...gameCounts, 0);
    const topPlayers = Object.entries(userGameCounts)
      .filter(([_, count]) => count === maxGames)
      .map(([name]) => name);
    
    // Growth trend
    const recentDays = sortedDays.slice(-7);
    const olderDays = sortedDays.slice(0, Math.max(0, sortedDays.length - 7));
    const recentAvg = recentDays.length > 0 ? 
      recentDays.reduce((sum, d) => sum + dailyUsers[d].size, 0) / recentDays.length : 0;
    const olderAvg = olderDays.length > 0 ? 
      olderDays.reduce((sum, d) => sum + dailyUsers[d].size, 0) / olderDays.length : 0;
    const growthRate = olderAvg > 0 ? ((recentAvg - olderAvg) / olderAvg * 100).toFixed(1) : 0;
    const trend = growthRate > 0 ? 'ðŸ“ˆ growing' : growthRate < 0 ? 'ðŸ“‰ declining' : 'âž¡ï¸ stable';
    
    return `
      <div style="line-height: 1.8;">
        <p><strong>Peak Hours:</strong> Highest activity at <strong>${peakHour}:00</strong> (${peakCount} users) vs quietest at <strong>${quietHour}:00</strong> (${quietCount} users). 
        <span class="tooltip-trigger"><i class="fas fa-info-circle" style="font-size: 0.875rem;"></i><span class="tooltip">Consider targeted campaigns during peak hours and re-engagement strategies during quiet periods.</span></span></p>
        
        <p><strong>Daily Engagement:</strong> Average <strong>${avgDailyUsers} unique users/day</strong> (range: ${minDailyUsers}-${maxDailyUsers}). 
        Recent 7-day trend is <strong>${trend}</strong> (${Math.abs(growthRate)}% ${growthRate > 0 ? 'increase' : growthRate < 0 ? 'decrease' : 'change'}).</p>
        
        <p><strong>User Retention:</strong> Average <strong>${avgGamesPerUser} games per player</strong>. 
        ${topPlayers.length > 0 ? `Top player${topPlayers.length > 1 ? 's' : ''}: <strong>${topPlayers.slice(0, 3).join(', ')}</strong> with ${maxGames} games each.` : ''}</p>
        
        <p><strong>Recommendation:</strong> ${growthRate > 0 ? 'Maintain momentum with new content.' : growthRate < 0 ? 'Focus on retention campaigns and new features.' : 'Stable growth - consider expansion strategies.'}</p>
      </div>
    `;
  }

  function generateLeaguesInsights(data) {
    const leagueCounts = {};
    const leagueScores = {};
    const leagueAccuracies = {};
    const leaguePlayers = {};
    const leagueTrends = {};
    
    data.forEach(row => {
      const league = String(row.League || '').toLowerCase();
      if (!league) return;
      
      leagueCounts[league] = (leagueCounts[league] || 0) + 1;
      
      if (row.Score > 0) {
        if (!leagueScores[league]) leagueScores[league] = [];
        leagueScores[league].push(row.Score);
      }
      
      if (row.Accuracy > 0) {
        if (!leagueAccuracies[league]) leagueAccuracies[league] = [];
        leagueAccuracies[league].push(row.Accuracy);
      }
      
      if (row.Name) {
        if (!leaguePlayers[league]) leaguePlayers[league] = new Set();
        leaguePlayers[league].add(row.Name);
      }
      
      // Track trends over time
      const dateInfo = parseDate(row.Date);
      if (dateInfo) {
        const week = Math.floor((dateInfo.date - new Date('2025-01-01')) / (7 * 24 * 60 * 60 * 1000));
        if (!leagueTrends[league]) leagueTrends[league] = {};
        leagueTrends[league][week] = (leagueTrends[league][week] || 0) + 1;
      }
    });
    
    const total = Object.values(leagueCounts).reduce((a, b) => a + b, 0);
    if (total === 0) return 'No league data available.';
    
    // Sort leagues by popularity
    const sortedLeagues = Object.entries(leagueCounts)
      .sort((a, b) => b[1] - a[1])
      .map(([league, count]) => ({
        league,
        count,
        percentage: ((count / total) * 100).toFixed(1),
        avgScore: leagueScores[league] ? 
          Math.round(leagueScores[league].reduce((a, b) => a + b, 0) / leagueScores[league].length) : 0,
        avgAccuracy: leagueAccuracies[league] ? 
          (leagueAccuracies[league].reduce((a, b) => a + b, 0) / leagueAccuracies[league].length).toFixed(1) : 0,
        uniquePlayers: leaguePlayers[league] ? leaguePlayers[league].size : 0,
        gamesPerPlayer: leaguePlayers[league] ? (count / leaguePlayers[league].size).toFixed(1) : 0
      }));
    
    const mostPopular = sortedLeagues[0];
    const leastPopular = sortedLeagues[sortedLeagues.length - 1];
    
    // Calculate difficulty progression
    const leagues = ['boulder', 'cascade', 'volcano', 'earth', 'custom'];
    const difficultyOrder = leagues.filter(l => leagueCounts[l]);
    const progression = difficultyOrder.length > 1 ? 
      difficultyOrder.map(l => l.charAt(0).toUpperCase() + l.slice(1)).join(' â†’ ') : 'N/A';
    
    // Find best performing league (highest avg score)
    const bestPerforming = sortedLeagues.reduce((a, b) => 
      a.avgScore > b.avgScore ? a : b
    );
    
    return `
      <div style="line-height: 1.8;">
        <p><strong>Popularity Ranking:</strong> 
        ${sortedLeagues.map((l, i) => `${i + 1}. <strong>${l.league.charAt(0).toUpperCase() + l.league.slice(1)}</strong> (${l.percentage}%, ${l.count} games)`).join(', ')}</p>
        
        <p><strong>Most Popular:</strong> <strong>${mostPopular.league.charAt(0).toUpperCase() + mostPopular.league.slice(1)}</strong> with ${mostPopular.percentage}% of games. 
        Average score: <strong>${mostPopular.avgScore.toLocaleString()}</strong>, accuracy: <strong>${mostPopular.avgAccuracy}%</strong>. 
        ${mostPopular.uniquePlayers} unique players averaging ${mostPopular.gamesPerPlayer} games each.</p>
        
        <p><strong>Best Performance:</strong> <strong>${bestPerforming.league.charAt(0).toUpperCase() + bestPerforming.league.slice(1)}</strong> has the highest average score (<strong>${bestPerforming.avgScore.toLocaleString()}</strong>), 
        suggesting optimal difficulty balance.</p>
        
        <p><strong>Difficulty Progression:</strong> ${progression}. 
        ${leastPopular.count > 0 ? `Least played: <strong>${leastPopular.league.charAt(0).toUpperCase() + leastPopular.league.slice(1)}</strong> (${leastPopular.percentage}%) - consider incentives or difficulty adjustment.` : ''}</p>
        
        <p><strong>Recommendation:</strong> ${mostPopular.percentage > 40 ? 'One league dominates - consider rebalancing difficulty or adding intermediate levels.' : 'Good distribution across leagues - maintain current balance.'}</p>
      </div>
    `;
  }

  function generatePerformanceInsights(data) {
    const scores = data.map(d => d.Score || 0).filter(s => s > 0);
    const accuracies = data.map(d => d.Accuracy || 0).filter(a => a > 0);
    
    if (scores.length === 0 || accuracies.length === 0) return 'Insufficient data for analysis.';
    
    const avgScore = scores.reduce((a, b) => a + b, 0) / scores.length;
    const avgAccuracy = accuracies.reduce((a, b) => a + b, 0) / accuracies.length;
    
    // Calculate statistics
    const sortedScores = [...scores].sort((a, b) => a - b);
    const sortedAccuracies = [...accuracies].sort((a, b) => a - b);
    const medianScore = sortedScores[Math.floor(sortedScores.length / 2)];
    const medianAccuracy = sortedAccuracies[Math.floor(sortedAccuracies.length / 2)];
    const q1Score = sortedScores[Math.floor(sortedScores.length * 0.25)];
    const q3Score = sortedScores[Math.floor(sortedScores.length * 0.75)];
    const q1Accuracy = sortedAccuracies[Math.floor(sortedAccuracies.length * 0.25)];
    const q3Accuracy = sortedAccuracies[Math.floor(sortedAccuracies.length * 0.75)];
    const minScore = sortedScores[0];
    const maxScore = sortedScores[sortedScores.length - 1];
    const minAccuracy = sortedAccuracies[0];
    const maxAccuracy = sortedAccuracies[sortedAccuracies.length - 1];
    
    // Calculate correlation
    const scoreAccPairs = data.filter(d => d.Score > 0 && d.Accuracy > 0);
    let correlation = 0;
    if (scoreAccPairs.length > 1) {
      const scoreMean = scoreAccPairs.reduce((sum, d) => sum + d.Score, 0) / scoreAccPairs.length;
      const accMean = scoreAccPairs.reduce((sum, d) => sum + d.Accuracy, 0) / scoreAccPairs.length;
      let numerator = 0, scoreVar = 0, accVar = 0;
      scoreAccPairs.forEach(d => {
        const scoreDiff = d.Score - scoreMean;
        const accDiff = d.Accuracy - accMean;
        numerator += scoreDiff * accDiff;
        scoreVar += scoreDiff * scoreDiff;
        accVar += accDiff * accDiff;
      });
      correlation = numerator / Math.sqrt(scoreVar * accVar);
    }
    
    const correlationStrength = Math.abs(correlation) > 0.7 ? 'strong' : Math.abs(correlation) > 0.4 ? 'moderate' : 'weak';
    
    // Performance tiers
    const highPerformers = scoreAccPairs.filter(d => d.Score > q3Score && d.Accuracy > q3Accuracy).length;
    const lowPerformers = scoreAccPairs.filter(d => d.Score < q1Score && d.Accuracy < q1Accuracy).length;
    const highPerformerPct = ((highPerformers / scoreAccPairs.length) * 100).toFixed(1);
    const lowPerformerPct = ((lowPerformers / scoreAccPairs.length) * 100).toFixed(1);
    
    // Score distribution analysis
    const excellentGames = scores.filter(s => s > q3Score).length;
    const poorGames = scores.filter(s => s < q1Score).length;
    
    // Accuracy distribution
    const highAccuracyGames = accuracies.filter(a => a > 90).length;
    const lowAccuracyGames = accuracies.filter(a => a < 70).length;
    
    return `
      <div style="line-height: 1.8;">
        <p><strong>Central Tendency:</strong> Average score <strong>${Math.round(avgScore).toLocaleString()}</strong> (median: ${medianScore.toLocaleString()}), 
        average accuracy <strong>${avgAccuracy.toFixed(1)}%</strong> (median: ${medianAccuracy.toFixed(1)}%).</p>
        
        <p><strong>Score Distribution:</strong> Range ${minScore.toLocaleString()} - ${maxScore.toLocaleString()}. 
        Q1: ${q1Score.toLocaleString()}, Q3: ${q3Score.toLocaleString()}. 
        ${excellentGames} games (${((excellentGames/scores.length)*100).toFixed(1)}%) exceed Q3, 
        ${poorGames} games (${((poorGames/scores.length)*100).toFixed(1)}%) below Q1.</p>
        
        <p><strong>Accuracy Distribution:</strong> Range ${minAccuracy.toFixed(1)}% - ${maxAccuracy.toFixed(1)}%. 
        ${highAccuracyGames} games (${((highAccuracyGames/accuracies.length)*100).toFixed(1)}%) above 90%, 
        ${lowAccuracyGames} games (${((lowAccuracyGames/accuracies.length)*100).toFixed(1)}%) below 70%.</p>
        
        <p><strong>Correlation Analysis:</strong> <strong>${correlationStrength}</strong> positive correlation (r=${correlation.toFixed(3)}) between accuracy and score. 
        ${correlation > 0.7 ? 'Strong relationship - accuracy improvements directly translate to higher scores.' : 
          correlation > 0.4 ? 'Moderate relationship - accuracy matters but other factors also influence scores.' : 
          'Weak relationship - consider other performance factors beyond accuracy.'}</p>
        
        <p><strong>Performance Tiers:</strong> ${highPerformerPct}% are high performers (high score + high accuracy), 
        ${lowPerformerPct}% are low performers (low score + low accuracy). 
        ${highPerformerPct > 25 ? 'Strong player base!' : 'Room for improvement in player performance.'}</p>
        
        <p><strong>Recommendation:</strong> ${correlation > 0.7 ? 'Focus on accuracy training - it directly impacts scores.' : 
          'Consider multi-factor performance analysis including speed, strategy, and consistency.'}</p>
      </div>
    `;
  }

  function generatePatternsInsights(data) {
    const hourCounts = Array(24).fill(0);
    const dayCounts = Array(7).fill(0);
    const hourlyScores = Array(24).fill(0).map(() => []);
    const dayScores = Array(7).fill(0).map(() => []);
    const weekdayNames = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
    
    data.forEach(row => {
      const dateInfo = parseDate(row.Date);
      if (dateInfo) {
        hourCounts[dateInfo.hour]++;
        dayCounts[dateInfo.dayOfWeek]++;
        
        if (row.Score > 0) {
          hourlyScores[dateInfo.hour].push(row.Score);
          dayScores[dateInfo.dayOfWeek].push(row.Score);
        }
      }
    });
    
    const peakHour = hourCounts.indexOf(Math.max(...hourCounts));
    const quietHour = hourCounts.indexOf(Math.min(...hourCounts.filter(c => c > 0)));
    const peakDayIdx = dayCounts.indexOf(Math.max(...dayCounts));
    const peakDay = weekdayNames[peakDayIdx];
    const quietDayIdx = dayCounts.indexOf(Math.min(...dayCounts.filter(c => c > 0)));
    const quietDay = weekdayNames[quietDayIdx];
    
    // Calculate average scores by hour/day
    const avgHourlyScores = hourlyScores.map(scores => 
      scores.length > 0 ? scores.reduce((a, b) => a + b, 0) / scores.length : 0
    );
    const avgDayScores = dayScores.map(scores => 
      scores.length > 0 ? scores.reduce((a, b) => a + b, 0) / scores.length : 0
    );
    
    const bestHourForScore = avgHourlyScores.indexOf(Math.max(...avgHourlyScores.filter(s => s > 0)));
    const bestDayForScore = avgDayScores.indexOf(Math.max(...avgDayScores.filter(s => s > 0)));
    
    // Time of day patterns
    const morning = hourCounts.slice(6, 12).reduce((a, b) => a + b, 0);
    const afternoon = hourCounts.slice(12, 18).reduce((a, b) => a + b, 0);
    const evening = hourCounts.slice(18, 24).reduce((a, b) => a + b, 0);
    const night = hourCounts.slice(0, 6).reduce((a, b) => a + b, 0);
    const total = morning + afternoon + evening + night;
    
    const timeOfDay = [
      { name: 'Morning (6am-12pm)', count: morning, pct: ((morning/total)*100).toFixed(1) },
      { name: 'Afternoon (12pm-6pm)', count: afternoon, pct: ((afternoon/total)*100).toFixed(1) },
      { name: 'Evening (6pm-12am)', count: evening, pct: ((evening/total)*100).toFixed(1) },
      { name: 'Night (12am-6am)', count: night, pct: ((night/total)*100).toFixed(1) }
    ].sort((a, b) => b.count - a.count);
    
    // Weekend vs weekday
    const weekend = dayCounts[0] + dayCounts[6]; // Sunday + Saturday
    const weekday = dayCounts.slice(1, 6).reduce((a, b) => a + b, 0);
    const weekendPct = ((weekend / (weekend + weekday)) * 100).toFixed(1);
    
    return `
      <div style="line-height: 1.8;">
        <p><strong>Peak Activity:</strong> Most games at <strong>${peakHour}:00</strong> (${hourCounts[peakHour]} games) vs quietest at <strong>${quietHour}:00</strong> (${hourCounts[quietHour]} games). 
        Best performance hour: <strong>${bestHourForScore}:00</strong> (avg score: ${Math.round(avgHourlyScores[bestHourForScore]).toLocaleString()}).</p>
        
        <p><strong>Day of Week:</strong> Most active on <strong>${peakDay}</strong> (${dayCounts[peakDayIdx]} games) vs quietest on <strong>${quietDay}</strong> (${dayCounts[quietDayIdx]} games). 
        Best performance day: <strong>${weekdayNames[bestDayForScore]}</strong> (avg score: ${Math.round(avgDayScores[bestDayForScore]).toLocaleString()}).</p>
        
        <p><strong>Time of Day Distribution:</strong> 
        ${timeOfDay.map(t => `${t.name}: ${t.pct}%`).join(', ')}. 
        ${timeOfDay[0].name} dominates with ${timeOfDay[0].pct}% of all games.</p>
        
        <p><strong>Weekend vs Weekday:</strong> ${weekendPct}% of games on weekends, ${(100 - weekendPct).toFixed(1)}% on weekdays. 
        ${parseFloat(weekendPct) > 40 ? 'Strong weekend engagement - consider weekend events.' : 'Balanced distribution - consistent engagement throughout the week.'}</p>
        
        <p><strong>Performance Patterns:</strong> ${bestHourForScore !== peakHour ? 
          `Peak activity (${peakHour}:00) doesn't match best performance (${bestHourForScore}:00) - players may be more casual during peak hours.` : 
          'Peak activity aligns with best performance - highly engaged players drive peak times.'}</p>
        
        <p><strong>Recommendation:</strong> Schedule content updates and events for <strong>${peakDay} at ${peakHour}:00</strong> to maximize reach. 
        Consider targeted campaigns during quiet periods (<strong>${quietDay} at ${quietHour}:00</strong>) to boost engagement.</p>
      </div>
    `;
  }

  // Create New vs Returning Users Chart
  function createNewReturningUsersChart(data) {
    const ctx = document.getElementById('newReturningUsersChart');
    if (!ctx) return;
    
    const userFirstGame = {};
    const userGameCounts = {};
    
    data.forEach(row => {
      if (!row.Name) return;
      const dateInfo = parseDate(row.Date);
      if (!dateInfo) return;
      
      if (!userFirstGame[row.Name] || dateInfo.timestamp < userFirstGame[row.Name]) {
        userFirstGame[row.Name] = dateInfo.timestamp;
      }
      userGameCounts[row.Name] = (userGameCounts[row.Name] || 0) + 1;
    });
    
    const sortedDates = data
      .map(row => ({ date: parseDate(row.Date), row }))
      .filter(d => d.date)
      .sort((a, b) => a.date.timestamp - b.date.timestamp);
    
    const dailyNew = {};
    const dailyReturning = {};
    
    sortedDates.forEach(({ date, row }) => {
      if (!row.Name) return;
      const day = date.dateOnly;
      if (!dailyNew[day]) dailyNew[day] = new Set();
      if (!dailyReturning[day]) dailyReturning[day] = new Set();
      
      if (userFirstGame[row.Name] === date.timestamp) {
        dailyNew[day].add(row.Name);
      } else {
        dailyReturning[day].add(row.Name);
      }
    });
    
    const sortedDays = Object.keys(dailyNew).sort();
    const newCounts = sortedDays.map(d => dailyNew[d].size);
    const returningCounts = sortedDays.map(d => dailyReturning[d].size);
    
    if (charts.newReturningUsers) {
      charts.newReturningUsers.data.datasets[0].data = newCounts;
      charts.newReturningUsers.data.datasets[1].data = returningCounts;
      charts.newReturningUsers.update('none');
    } else {
      charts.newReturningUsers = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: sortedDays.map(d => new Date(d).toLocaleDateString('en-US', { month: 'short', day: 'numeric' })),
          datasets: [
            {
              label: 'New Users',
              data: newCounts,
              backgroundColor: '#3b82f6',
              borderRadius: 4
            },
            {
              label: 'Returning Users',
              data: returningCounts,
              backgroundColor: '#10b981',
              borderRadius: 4
            }
          ]
        },
        options: {
          responsive: true,
          maintainAspectRatio: true,
          plugins: {
            legend: { position: 'top' }
          },
          scales: {
            y: {
              beginAtZero: true,
              grid: { color: '#f3f4f6' },
              ticks: { color: '#6b7280', font: { size: 11 } },
              title: { display: true, text: 'Users', color: '#6b7280', font: { size: 12 } }
            },
            x: {
              grid: { display: false },
              ticks: { color: '#6b7280', font: { size: 10 }, maxRotation: 45 }
            }
          }
        }
      });
    }
  }
  
  // Create User Engagement Distribution Chart
  function createUserEngagementChart(data) {
    const ctx = document.getElementById('userEngagementChart');
    if (!ctx) return;
    
    const userGameCounts = {};
    data.forEach(row => {
      if (row.Name) {
        userGameCounts[row.Name] = (userGameCounts[row.Name] || 0) + 1;
      }
    });
    
    const counts = Object.values(userGameCounts);
    const buckets = {
      '1 game': counts.filter(c => c === 1).length,
      '2-5 games': counts.filter(c => c >= 2 && c <= 5).length,
      '6-10 games': counts.filter(c => c >= 6 && c <= 10).length,
      '11-20 games': counts.filter(c => c >= 11 && c <= 20).length,
      '20+ games': counts.filter(c => c > 20).length
    };
    
    if (charts.userEngagement) {
      charts.userEngagement.data.datasets[0].data = Object.values(buckets);
      charts.userEngagement.update('none');
    } else {
      charts.userEngagement = new Chart(ctx, {
        type: 'doughnut',
        data: {
          labels: Object.keys(buckets),
          datasets: [{
            data: Object.values(buckets),
            backgroundColor: ['#3b82f6', '#10b981', '#f59e0b', '#ef4444', '#8b5cf6'],
            borderWidth: 0
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: true,
          plugins: {
            legend: { position: 'bottom', labels: { padding: 12, font: { size: 11 } } }
          }
        }
      });
    }
  }
  
  // Create Daily Active Users Chart
  function createDailyActiveUsersChart(data) {
    const el = document.getElementById('dailyActiveUsersChart');
    if (!el) return;
    
    const dailyUsers = {};
    data.forEach(row => {
      const dateInfo = parseDate(row.Date);
      if (!dateInfo) return;
      const day = dateInfo.dateOnly;
      if (!dailyUsers[day]) dailyUsers[day] = new Set();
      if (row.Name) dailyUsers[day].add(row.Name);
    });
    
    const sortedDays = Object.keys(dailyUsers).sort();
    const x = sortedDays.map(d => new Date(d + 'T00:00:00'));
    const y = sortedDays.map(d => dailyUsers[d].size);
    
    const trace = {
      x: x,
      y: y,
      type: 'scatter',
      mode: 'lines+markers',
      name: 'Daily Active Users',
      line: { color: '#3b82f6', width: 2.5, shape: 'spline', smoothing: 1.3 },
      marker: { size: 6, color: '#3b82f6' },
      fill: 'tozeroy',
      fillcolor: 'rgba(59, 130, 246, 0.1)',
      hovertemplate: '<b>%{fullData.name}</b><br>%{x|%b %d, %Y}<br>DAU: %{y}<extra></extra>'
    };
    
    const layout = {
      ...plotlyTheme,
      xaxis: { ...plotlyTheme.xaxis, title: { text: 'Date', font: { color: '#6b7280', size: 12 } } },
      yaxis: { ...plotlyTheme.yaxis, title: { text: 'Daily Active Users', font: { color: '#6b7280', size: 12 } } },
      showlegend: false
    };
    
    Plotly.newPlot(el, [trace], layout, { responsive: true, displayModeBar: true });
  }
  
  // Create Players Per League Chart
  function createPlayersPerLeagueChart(data) {
    const ctx = document.getElementById('playersPerLeagueChart');
    if (!ctx) return;
    
    const leaguePlayers = {};
    data.forEach(row => {
      const league = String(row.League || '').toLowerCase();
      if (!league || !row.Name) return;
      if (!leaguePlayers[league]) leaguePlayers[league] = new Set();
      leaguePlayers[league].add(row.Name);
    });
    
    const leagues = Object.keys(leaguePlayers);
    const playerCounts = leagues.map(l => leaguePlayers[l].size);
    const bgColors = leagues.map(l => colors[l] || colors.primary);
    
    if (charts.playersPerLeague) {
      charts.playersPerLeague.data.labels = leagues.map(l => l.charAt(0).toUpperCase() + l.slice(1));
      charts.playersPerLeague.data.datasets[0].data = playerCounts;
      charts.playersPerLeague.data.datasets[0].backgroundColor = bgColors;
      charts.playersPerLeague.update('none');
    } else {
      charts.playersPerLeague = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: leagues.map(l => l.charAt(0).toUpperCase() + l.slice(1)),
          datasets: [{
            label: 'Unique Players',
            data: playerCounts,
            backgroundColor: bgColors,
            borderRadius: 6
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: true,
          plugins: {
            legend: { display: false }
          },
          scales: {
            y: {
              beginAtZero: true,
              grid: { color: '#f3f4f6' },
              ticks: { color: '#6b7280', font: { size: 11 } },
              title: { display: true, text: 'Unique Players', color: '#6b7280', font: { size: 12 } }
            },
            x: {
              grid: { display: false },
              ticks: { color: '#6b7280', font: { size: 11 } }
            }
          }
        }
      });
    }
  }
  
  // Create League Score Trend Chart
  function createLeagueScoreTrendChart(data) {
    const el = document.getElementById('leagueScoreTrendChart');
    if (!el) return;
    
    const leagues = ['boulder', 'cascade', 'volcano', 'earth', 'custom'];
    const dailyScores = {};
    
    data.forEach(row => {
      const dateInfo = parseDate(row.Date);
      if (!dateInfo || !row.Score || row.Score <= 0) return;
      const league = String(row.League || '').toLowerCase();
      if (!leagues.includes(league)) return;
      
      const day = dateInfo.dateOnly;
      if (!dailyScores[day]) dailyScores[day] = {};
      if (!dailyScores[day][league]) dailyScores[day][league] = [];
      dailyScores[day][league].push(row.Score);
    });
    
    const sortedDays = Object.keys(dailyScores).sort();
    const x = sortedDays.map(d => new Date(d + 'T00:00:00'));
    
    const traces = leagues.map(league => {
      const y = sortedDays.map(day => {
        const scores = dailyScores[day]?.[league] || [];
        return scores.length > 0 ? scores.reduce((a, b) => a + b, 0) / scores.length : null;
      });
      
      return {
        x: x,
        y: y,
        type: 'scatter',
        mode: 'lines+markers',
        name: league.charAt(0).toUpperCase() + league.slice(1),
        line: { color: colors[league] || colors.primary, width: 2.5 },
        marker: { size: 4, color: colors[league] || colors.primary },
        hovertemplate: `<b>%{fullData.name}</b><br>%{x|%b %d}<br>Avg Score: %{y:,.0f}<extra></extra>`
      };
    });
    
    const layout = {
      ...plotlyTheme,
      xaxis: { ...plotlyTheme.xaxis, title: { text: 'Date', font: { color: '#6b7280', size: 12 } } },
      yaxis: { ...plotlyTheme.yaxis, title: { text: 'Average Score', font: { color: '#6b7280', size: 12 } } }
    };
    
    Plotly.newPlot(el, traces, layout, { responsive: true, displayModeBar: true });
  }
  
  // Create League Accuracy Trend Chart
  function createLeagueAccuracyTrendChart(data) {
    const el = document.getElementById('leagueAccuracyTrendChart');
    if (!el) return;
    
    const leagues = ['boulder', 'cascade', 'volcano', 'earth', 'custom'];
    const dailyAccuracies = {};
    
    data.forEach(row => {
      const dateInfo = parseDate(row.Date);
      if (!dateInfo || !row.Accuracy || row.Accuracy <= 0) return;
      const league = String(row.League || '').toLowerCase();
      if (!leagues.includes(league)) return;
      
      const day = dateInfo.dateOnly;
      if (!dailyAccuracies[day]) dailyAccuracies[day] = {};
      if (!dailyAccuracies[day][league]) dailyAccuracies[day][league] = [];
      dailyAccuracies[day][league].push(row.Accuracy);
    });
    
    const sortedDays = Object.keys(dailyAccuracies).sort();
    const x = sortedDays.map(d => new Date(d + 'T00:00:00'));
    
    const traces = leagues.map(league => {
      const y = sortedDays.map(day => {
        const accuracies = dailyAccuracies[day]?.[league] || [];
        return accuracies.length > 0 ? accuracies.reduce((a, b) => a + b, 0) / accuracies.length : null;
      });
      
      return {
        x: x,
        y: y,
        type: 'scatter',
        mode: 'lines+markers',
        name: league.charAt(0).toUpperCase() + league.slice(1),
        line: { color: colors[league] || colors.primary, width: 2.5 },
        marker: { size: 4, color: colors[league] || colors.primary },
        hovertemplate: `<b>%{fullData.name}</b><br>%{x|%b %d}<br>Avg Accuracy: %{y:.1f}%<extra></extra>`
      };
    });
    
    const layout = {
      ...plotlyTheme,
      xaxis: { ...plotlyTheme.xaxis, title: { text: 'Date', font: { color: '#6b7280', size: 12 } } },
      yaxis: { ...plotlyTheme.yaxis, title: { text: 'Average Accuracy (%)', font: { color: '#6b7280', size: 12 } }, range: [0, 100] }
    };
    
    Plotly.newPlot(el, traces, layout, { responsive: true, displayModeBar: true });
  }
  
  // Create Accuracy Distribution Chart
  function createAccuracyDistributionChart(data) {
    const ctx = document.getElementById('accuracyDistributionChart');
    if (!ctx) return;
    
    const leagues = ['boulder', 'cascade', 'volcano', 'earth', 'custom'];
    const stats = leagues.map(league => {
      const accuracies = data
        .filter(row => String(row.League || '').toLowerCase() === league && row.Accuracy > 0)
        .map(row => row.Accuracy)
        .sort((a, b) => a - b);
      
      if (accuracies.length === 0) {
        return { league: league.charAt(0).toUpperCase() + league.slice(1), avg: 0, median: 0 };
      }
      
      const medianIdx = Math.floor(accuracies.length * 0.5);
      return {
        league: league.charAt(0).toUpperCase() + league.slice(1),
        avg: accuracies.reduce((a, b) => a + b, 0) / accuracies.length,
        median: accuracies[medianIdx]
      };
    });
    
    if (charts.accuracyDistribution) {
      charts.accuracyDistribution.data.labels = stats.map(s => s.league);
      charts.accuracyDistribution.data.datasets[0].data = stats.map(s => s.avg);
      charts.accuracyDistribution.data.datasets[1].data = stats.map(s => s.median);
      charts.accuracyDistribution.update('none');
    } else {
      charts.accuracyDistribution = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: stats.map(s => s.league),
          datasets: [
            {
              label: 'Average Accuracy',
              data: stats.map(s => s.avg),
              backgroundColor: leagues.map(l => (colors[l] || colors.primary) + '80'),
              borderColor: leagues.map(l => colors[l] || colors.primary),
              borderWidth: 1
            },
            {
              label: 'Median Accuracy',
              data: stats.map(s => s.median),
              backgroundColor: leagues.map(l => (colors[l] || colors.primary) + '40'),
              borderColor: leagues.map(l => colors[l] || colors.primary),
              borderWidth: 1,
              borderDash: [5, 5]
            }
          ]
        },
        options: {
          responsive: true,
          maintainAspectRatio: true,
          plugins: {
            legend: { position: 'top' }
          },
          scales: {
            y: {
              beginAtZero: true,
              max: 100,
              grid: { color: '#f3f4f6' },
              ticks: { color: '#6b7280', font: { size: 11 } },
              title: { display: true, text: 'Accuracy (%)', color: '#6b7280', font: { size: 12 } }
            },
            x: {
              grid: { display: false },
              ticks: { color: '#6b7280', font: { size: 11 } }
            }
          }
        }
      });
    }
  }
  
  // Create Score Trend Chart
  function createScoreTrendChart(data) {
    const el = document.getElementById('scoreTrendChart');
    if (!el) return;
    
    const dailyScores = {};
    data.forEach(row => {
      const dateInfo = parseDate(row.Date);
      if (!dateInfo || !row.Score || row.Score <= 0) return;
      const day = dateInfo.dateOnly;
      if (!dailyScores[day]) dailyScores[day] = [];
      dailyScores[day].push(row.Score);
    });
    
    const sortedDays = Object.keys(dailyScores).sort();
    const x = sortedDays.map(d => new Date(d + 'T00:00:00'));
    const y = sortedDays.map(day => {
      const scores = dailyScores[day];
      return scores.reduce((a, b) => a + b, 0) / scores.length;
    });
    
    const trace = {
      x: x,
      y: y,
      type: 'scatter',
      mode: 'lines+markers',
      name: 'Average Score',
      line: { color: '#3b82f6', width: 3, shape: 'spline', smoothing: 1.3 },
      marker: { size: 6, color: '#3b82f6' },
      fill: 'tozeroy',
      fillcolor: 'rgba(59, 130, 246, 0.1)',
      hovertemplate: '<b>%{fullData.name}</b><br>%{x|%b %d, %Y}<br>Avg Score: %{y:,.0f}<extra></extra>'
    };
    
    const layout = {
      ...plotlyTheme,
      xaxis: { ...plotlyTheme.xaxis, title: { text: 'Date', font: { color: '#6b7280', size: 12 } } },
      yaxis: { ...plotlyTheme.yaxis, title: { text: 'Average Score', font: { color: '#6b7280', size: 12 } } },
      showlegend: false
    };
    
    Plotly.newPlot(el, [trace], layout, { responsive: true, displayModeBar: true });
  }
  
  // Create Score Histogram Chart
  function createScoreHistogramChart(data) {
    const ctx = document.getElementById('scoreHistogramChart');
    if (!ctx) return;
    
    const scores = data.map(d => d.Score || 0).filter(s => s > 0);
    if (scores.length === 0) return;
    
    const maxScore = Math.max(...scores);
    const binSize = Math.ceil(maxScore / 20);
    const bins = {};
    
    scores.forEach(score => {
      const bin = Math.floor(score / binSize) * binSize;
      bins[bin] = (bins[bin] || 0) + 1;
    });
    
    const sortedBins = Object.keys(bins).map(Number).sort((a, b) => a - b);
    const labels = sortedBins.map(b => `${b}-${b + binSize}`);
    const values = sortedBins.map(b => bins[b]);
    
    if (charts.scoreHistogram) {
      charts.scoreHistogram.data.labels = labels;
      charts.scoreHistogram.data.datasets[0].data = values;
      charts.scoreHistogram.update('none');
    } else {
      charts.scoreHistogram = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: labels,
          datasets: [{
            label: 'Frequency',
            data: values,
            backgroundColor: '#3b82f6',
            borderRadius: 4
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: true,
          plugins: {
            legend: { display: false }
          },
          scales: {
            y: {
              beginAtZero: true,
              grid: { color: '#f3f4f6' },
              ticks: { color: '#6b7280', font: { size: 11 } },
              title: { display: true, text: 'Frequency', color: '#6b7280', font: { size: 12 } }
            },
            x: {
              grid: { display: false },
              ticks: { color: '#6b7280', font: { size: 10 }, maxRotation: 45 }
            }
          }
        }
      });
    }
  }
  
  // Create Accuracy Histogram Chart
  function createAccuracyHistogramChart(data) {
    const ctx = document.getElementById('accuracyHistogramChart');
    if (!ctx) return;
    
    const accuracies = data.map(d => d.Accuracy || 0).filter(a => a > 0);
    if (accuracies.length === 0) return;
    
    const binSize = 5; // 5% bins
    const bins = {};
    
    accuracies.forEach(acc => {
      const bin = Math.floor(acc / binSize) * binSize;
      bins[bin] = (bins[bin] || 0) + 1;
    });
    
    const sortedBins = Object.keys(bins).map(Number).sort((a, b) => a - b);
    const labels = sortedBins.map(b => `${b}-${b + binSize}%`);
    const values = sortedBins.map(b => bins[b]);
    
    if (charts.accuracyHistogram) {
      charts.accuracyHistogram.data.labels = labels;
      charts.accuracyHistogram.data.datasets[0].data = values;
      charts.accuracyHistogram.update('none');
    } else {
      charts.accuracyHistogram = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: labels,
          datasets: [{
            label: 'Frequency',
            data: values,
            backgroundColor: '#10b981',
            borderRadius: 4
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: true,
          plugins: {
            legend: { display: false }
          },
          scales: {
            y: {
              beginAtZero: true,
              grid: { color: '#f3f4f6' },
              ticks: { color: '#6b7280', font: { size: 11 } },
              title: { display: true, text: 'Frequency', color: '#6b7280', font: { size: 12 } }
            },
            x: {
              grid: { display: false },
              ticks: { color: '#6b7280', font: { size: 10 } }
            }
          }
        }
      });
    }
  }
  
  // Create Player Progression Chart
  function createPlayerProgressionChart(data) {
    const el = document.getElementById('playerProgressionChart');
    if (!el) return;
    
    const playerGames = {};
    data.forEach(row => {
      if (!row.Name || !row.Score || row.Score <= 0) return;
      const dateInfo = parseDate(row.Date);
      if (!dateInfo) return;
      
      if (!playerGames[row.Name]) playerGames[row.Name] = [];
      playerGames[row.Name].push({
        timestamp: dateInfo.timestamp,
        score: row.Score,
        gameNum: playerGames[row.Name].length + 1
      });
    });
    
    // Sample players (top 20 by game count) for readability
    const topPlayers = Object.entries(playerGames)
      .sort((a, b) => b[1].length - a[1].length)
      .slice(0, 20);
    
    const traces = topPlayers.map(([name, games]) => {
      const sortedGames = games.sort((a, b) => a.timestamp - b.timestamp);
      return {
        x: sortedGames.map(g => g.gameNum),
        y: sortedGames.map(g => g.score),
        type: 'scatter',
        mode: 'lines',
        name: name.length > 15 ? name.substring(0, 15) + '...' : name,
        line: { width: 1.5, color: 'rgba(59, 130, 246, 0.3)' },
        hovertemplate: `<b>%{fullData.name}</b><br>Game #%{x}<br>Score: %{y:,.0f}<extra></extra>`,
        showlegend: false
      };
    });
    
    const layout = {
      ...plotlyTheme,
      xaxis: { ...plotlyTheme.xaxis, title: { text: 'Game Number', font: { color: '#6b7280', size: 12 } } },
      yaxis: { ...plotlyTheme.yaxis, title: { text: 'Score', font: { color: '#6b7280', size: 12 } } }
    };
    
    Plotly.newPlot(el, traces, layout, { responsive: true, displayModeBar: true });
  }
  
  // Create Hour/Day Heatmap Chart
  function createHourDayHeatmapChart(data) {
    const el = document.getElementById('hourDayHeatmapChart');
    if (!el) return;
    
    const heatmapData = {};
    const days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
    
    data.forEach(row => {
      const dateInfo = parseDate(row.Date);
      if (!dateInfo) return;
      const hour = dateInfo.hour;
      const day = dateInfo.dayOfWeek;
      const key = `${day}-${hour}`;
      heatmapData[key] = (heatmapData[key] || 0) + 1;
    });
    
    const z = [];
    const y = days;
    const x = Array.from({length: 24}, (_, i) => i);
    
    days.forEach((day, dayIdx) => {
      const row = [];
      x.forEach(hour => {
        const key = `${dayIdx}-${hour}`;
        row.push(heatmapData[key] || 0);
      });
      z.push(row);
    });
    
    const trace = {
      x: x,
      y: y,
      z: z,
      type: 'heatmap',
      colorscale: [[0, '#f3f4f6'], [0.5, '#93c5fd'], [1, '#3b82f6']],
      showscale: true,
      hovertemplate: '<b>%{y}</b><br>Hour: %{x}:00<br>Games: %{z}<extra></extra>'
    };
    
    const layout = {
      ...plotlyTheme,
      xaxis: { ...plotlyTheme.xaxis, title: { text: 'Hour of Day', font: { color: '#6b7280', size: 12 } } },
      yaxis: { ...plotlyTheme.yaxis, title: { text: 'Day of Week', font: { color: '#6b7280', size: 12 } } }
    };
    
    Plotly.newPlot(el, [trace], layout, { responsive: true, displayModeBar: true });
  }
  
  // Create Score By Hour Chart
  function createScoreByHourChart(data) {
    const ctx = document.getElementById('scoreByHourChart');
    if (!ctx) return;
    
    const hourlyScores = Array(24).fill(0).map(() => []);
    data.forEach(row => {
      const dateInfo = parseDate(row.Date);
      if (dateInfo && row.Score > 0) {
        hourlyScores[dateInfo.hour].push(row.Score);
      }
    });
    
    const avgScores = hourlyScores.map(scores => 
      scores.length > 0 ? scores.reduce((a, b) => a + b, 0) / scores.length : 0
    );
    const labels = Array.from({length: 24}, (_, i) => i + ':00');
    
    if (charts.scoreByHour) {
      charts.scoreByHour.data.datasets[0].data = avgScores;
      charts.scoreByHour.update('none');
    } else {
      charts.scoreByHour = new Chart(ctx, {
        type: 'line',
        data: {
          labels: labels,
          datasets: [{
            label: 'Average Score',
            data: avgScores,
            borderColor: '#3b82f6',
            backgroundColor: 'rgba(59, 130, 246, 0.1)',
            fill: true,
            tension: 0.4,
            pointRadius: 3
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: true,
          plugins: {
            legend: { display: false }
          },
          scales: {
            y: {
              beginAtZero: true,
              grid: { color: '#f3f4f6' },
              ticks: { color: '#6b7280', font: { size: 11 } },
              title: { display: true, text: 'Average Score', color: '#6b7280', font: { size: 12 } }
            },
            x: {
              grid: { display: false },
              ticks: { color: '#6b7280', font: { size: 10 } },
              title: { display: true, text: 'Hour', color: '#6b7280', font: { size: 12 } }
            }
          }
        }
      });
    }
  }
  
  // Create Score By Day Chart
  function createScoreByDayChart(data) {
    const ctx = document.getElementById('scoreByDayChart');
    if (!ctx) return;
    
    const dayScores = Array(7).fill(0).map(() => []);
    const days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
    
    data.forEach(row => {
      const dateInfo = parseDate(row.Date);
      if (dateInfo && row.Score > 0) {
        dayScores[dateInfo.dayOfWeek].push(row.Score);
      }
    });
    
    const avgScores = dayScores.map(scores => 
      scores.length > 0 ? scores.reduce((a, b) => a + b, 0) / scores.length : 0
    );
    
    if (charts.scoreByDay) {
      charts.scoreByDay.data.datasets[0].data = avgScores;
      charts.scoreByDay.update('none');
    } else {
      charts.scoreByDay = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: days,
          datasets: [{
            label: 'Average Score',
            data: avgScores,
            backgroundColor: '#3b82f6',
            borderRadius: 6
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: true,
          plugins: {
            legend: { display: false }
          },
          scales: {
            y: {
              beginAtZero: true,
              grid: { color: '#f3f4f6' },
              ticks: { color: '#6b7280', font: { size: 11 } },
              title: { display: true, text: 'Average Score', color: '#6b7280', font: { size: 12 } }
            },
            x: {
              grid: { display: false },
              ticks: { color: '#6b7280', font: { size: 11 } },
              title: { display: true, text: 'Day of Week', color: '#6b7280', font: { size: 12 } }
            }
          }
        }
      });
    }
  }
  
  // Create Weekly Pattern Chart
  function createWeeklyPatternChart(data) {
    const el = document.getElementById('weeklyPatternChart');
    if (!el) return;
    
    const weeklyData = {};
    data.forEach(row => {
      const dateInfo = parseDate(row.Date);
      if (!dateInfo) return;
      const weekStart = new Date(dateInfo.date);
      weekStart.setDate(weekStart.getDate() - weekStart.getDay());
      weekStart.setHours(0, 0, 0, 0);
      const weekKey = weekStart.toISOString().split('T')[0];
      
      if (!weeklyData[weekKey]) weeklyData[weekKey] = [];
      weeklyData[weekKey].push(dateInfo.dateOnly);
    });
    
    const sortedWeeks = Object.keys(weeklyData).sort();
    const x = sortedWeeks.map(w => new Date(w + 'T00:00:00'));
    const y = sortedWeeks.map(w => {
      const days = weeklyData[w];
      return new Set(days).size; // Unique days per week
    });
    
    const trace = {
      x: x,
      y: y,
      type: 'bar',
      marker: {
        color: y,
        colorscale: [[0, '#dbeafe'], [1, '#3b82f6']],
        showscale: false
      },
      hovertemplate: '<b>Week of %{x|%b %d}</b><br>Active Days: %{y}<extra></extra>'
    };
    
    const layout = {
      ...plotlyTheme,
      xaxis: { ...plotlyTheme.xaxis, title: { text: 'Week', font: { color: '#6b7280', size: 12 } } },
      yaxis: { ...plotlyTheme.yaxis, title: { text: 'Active Days per Week', font: { color: '#6b7280', size: 12 } }, range: [0, 7] },
      showlegend: false
    };
    
    Plotly.newPlot(el, [trace], layout, { responsive: true, displayModeBar: true });
  }
  
  // Create overview charts
  function createOverviewCharts(data) {
    // League distribution for overview
    const ctx1 = document.getElementById('overview-league-chart');
    if (ctx1) {
      const counts = {};
      data.forEach(row => {
        const league = String(row.League || 'Unknown').toLowerCase();
        counts[league] = (counts[league] || 0) + 1;
      });
      
      const labels = Object.keys(counts);
      const values = Object.values(counts);
      const bgColors = labels.map(l => colors[l] || colors.primary);
      
      if (charts.overviewLeague) {
        charts.overviewLeague.data.labels = labels.map(l => l.charAt(0).toUpperCase() + l.slice(1));
        charts.overviewLeague.data.datasets[0].data = values;
        charts.overviewLeague.data.datasets[0].backgroundColor = bgColors;
        charts.overviewLeague.update('none');
      } else {
        charts.overviewLeague = new Chart(ctx1, {
          type: 'doughnut',
          data: {
            labels: labels.map(l => l.charAt(0).toUpperCase() + l.slice(1)),
            datasets: [{
              data: values,
              backgroundColor: bgColors,
              borderWidth: 0
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: true,
            plugins: {
              legend: { 
                position: 'bottom',
                labels: { padding: 12, font: { size: 11 } }
              }
            }
          }
        });
      }
    }
    
    // Hour distribution for overview
    const ctx2 = document.getElementById('overview-hour-chart');
    if (ctx2) {
      const counts = Array(24).fill(0);
      data.forEach(row => {
        const dateInfo = parseDate(row.Date);
        if (dateInfo) counts[dateInfo.hour]++;
      });
      
      const labels = Array.from({length: 24}, (_, i) => i + ':00');
      
      if (charts.overviewHour) {
        charts.overviewHour.data.datasets[0].data = counts;
        charts.overviewHour.update('none');
      } else {
        charts.overviewHour = new Chart(ctx2, {
          type: 'bar',
          data: {
            labels,
            datasets: [{
              label: 'Games',
              data: counts,
              backgroundColor: '#3b82f6',
              borderWidth: 0,
              borderRadius: 4
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: true,
            plugins: {
              legend: { display: false }
            },
            scales: {
              y: {
                beginAtZero: true,
                grid: { color: '#f3f4f6' },
                ticks: { color: '#6b7280', font: { size: 10 } }
              },
              x: {
                grid: { display: false },
                ticks: { color: '#6b7280', font: { size: 10 }, maxRotation: 45 }
              }
            }
          }
        });
      }
    }
  }

  function generateKeyInsights(data) {
    const totalGames = allData.length;
    const uniquePlayers = new Set(allData.map(d => d.Name).filter(Boolean)).size;
    const scores = data.map(d => d.Score || 0).filter(s => s > 0);
    const accuracies = data.map(d => d.Accuracy || 0).filter(a => a > 0);
    
    const avgScore = scores.length > 0 ? scores.reduce((a, b) => a + b, 0) / scores.length : 0;
    const avgAccuracy = accuracies.length > 0 ? accuracies.reduce((a, b) => a + b, 0) / accuracies.length : 0;
    
    // League analysis
    const leagueCounts = {};
    const leagueScores = {};
    allData.forEach(row => {
      const league = String(row.League || '').toLowerCase();
      if (league) {
        leagueCounts[league] = (leagueCounts[league] || 0) + 1;
        if (row.Score > 0) {
          if (!leagueScores[league]) leagueScores[league] = [];
          leagueScores[league].push(row.Score);
        }
      }
    });
    
    const totalWithLeague = Object.values(leagueCounts).reduce((a, b) => a + b, 0);
    const mostPopularLeague = Object.keys(leagueCounts).reduce((a, b) => 
      leagueCounts[a] > leagueCounts[b] ? a : b
    ) || 'N/A';
    
    // Player engagement
    const playerGameCounts = {};
    allData.forEach(row => {
      if (row.Name) {
        playerGameCounts[row.Name] = (playerGameCounts[row.Name] || 0) + 1;
      }
    });
    
    const gameCounts = Object.values(playerGameCounts);
    const gamesPerPlayer = uniquePlayers > 0 ? (totalGames / uniquePlayers).toFixed(1) : 0;
    const medianGamesPerPlayer = gameCounts.length > 0 ? 
      [...gameCounts].sort((a, b) => a - b)[Math.floor(gameCounts.length / 2)] : 0;
    const top10Percent = Math.ceil(uniquePlayers * 0.1);
    const topPlayers = Object.entries(playerGameCounts)
      .sort((a, b) => b[1] - a[1])
      .slice(0, top10Percent);
    const topPlayerGames = topPlayers.reduce((sum, [_, count]) => sum + count, 0);
    const topPlayerPct = ((topPlayerGames / totalGames) * 100).toFixed(1);
    
    // Growth analysis
    const sortedDates = allData
      .map(row => ({ date: parseDate(row.Date), row }))
      .filter(d => d.date)
      .sort((a, b) => a.date.timestamp - b.date.timestamp);
    
    const firstWeek = sortedDates.slice(0, Math.min(100, sortedDates.length));
    const lastWeek = sortedDates.slice(-Math.min(100, sortedDates.length));
    const firstWeekGames = firstWeek.length;
    const lastWeekGames = lastWeek.length;
    const growthRate = firstWeekGames > 0 ? ((lastWeekGames - firstWeekGames) / firstWeekGames * 100).toFixed(1) : 0;
    
    // Retention analysis
    const oneGamePlayers = gameCounts.filter(c => c === 1).length;
    const multiGamePlayers = gameCounts.filter(c => c > 1).length;
    const retentionRate = uniquePlayers > 0 ? ((multiGamePlayers / uniquePlayers) * 100).toFixed(1) : 0;
    
    // Performance trends
    const recentScores = sortedDates.slice(-100).map(d => d.row.Score || 0).filter(s => s > 0);
    const olderScores = sortedDates.slice(0, Math.min(100, sortedDates.length)).map(d => d.row.Score || 0).filter(s => s > 0);
    const recentAvgScore = recentScores.length > 0 ? recentScores.reduce((a, b) => a + b, 0) / recentScores.length : 0;
    const olderAvgScore = olderScores.length > 0 ? olderScores.reduce((a, b) => a + b, 0) / olderScores.length : 0;
    const scoreTrend = olderAvgScore > 0 ? ((recentAvgScore - olderAvgScore) / olderAvgScore * 100).toFixed(1) : 0;
    
    return `
      <div style="line-height: 1.8;">
        <h4 style="margin-bottom: 1rem; color: #0a0a0f;"><i class="fas fa-chart-bar"></i> Engagement Metrics</h4>
        <p><strong>Scale:</strong> ${totalGames.toLocaleString()} total games from ${uniquePlayers.toLocaleString()} unique players (avg ${gamesPerPlayer} games/player, median ${medianGamesPerPlayer}).</p>
        <p><strong>Retention:</strong> ${retentionRate}% of players returned for multiple games. ${oneGamePlayers} one-time players vs ${multiGamePlayers} repeat players.</p>
        <p><strong>Power Users:</strong> Top 10% of players (${top10Percent} players) account for ${topPlayerPct}% of all games, showing strong engagement from core user base.</p>
        
        <h4 style="margin-top: 1.5rem; margin-bottom: 1rem; color: #0a0a0f;"><i class="fas fa-trophy"></i> Performance Overview</h4>
        <p><strong>Current Stats:</strong> Average score ${Math.round(avgScore).toLocaleString()} with ${avgAccuracy.toFixed(1)}% accuracy.</p>
        <p><strong>Trend:</strong> ${Math.abs(scoreTrend) > 5 ? 
          `Recent games show ${Math.abs(scoreTrend)}% ${scoreTrend > 0 ? 'improvement' : 'decline'} in average score compared to earlier games.` : 
          'Performance remains stable over time.'}</p>
        
        <h4 style="margin-top: 1.5rem; margin-bottom: 1rem; color: #0a0a0f;"><i class="fas fa-bullseye"></i> League Distribution</h4>
        <p><strong>Coverage:</strong> ${totalWithLeague.toLocaleString()} games (${((totalWithLeague/totalGames)*100).toFixed(1)}%) have league data. 
        ${totalGames - totalWithLeague > 0 ? `${(totalGames - totalWithLeague).toLocaleString()} games missing league classification.` : 'All games properly classified.'}</p>
        ${mostPopularLeague !== 'N/A' ? `<p><strong>Most Popular:</strong> ${mostPopularLeague.charAt(0).toUpperCase() + mostPopularLeague.slice(1)} league with ${leagueCounts[mostPopularLeague]} games (${((leagueCounts[mostPopularLeague]/totalWithLeague)*100).toFixed(1)}%).</p>` : ''}
        
        <h4 style="margin-top: 1.5rem; margin-bottom: 1rem; color: #0a0a0f;"><i class="fas fa-chart-line"></i> Growth Analysis</h4>
        <p><strong>Activity Trend:</strong> ${Math.abs(growthRate) > 10 ? 
          `Recent activity shows ${Math.abs(growthRate)}% ${growthRate > 0 ? 'growth' : 'decline'} compared to early period.` : 
          'Activity levels remain consistent.'}</p>
        
        <h4 style="margin-top: 1.5rem; margin-bottom: 1rem; color: #0a0a0f;"><i class="fas fa-lightbulb"></i> Strategic Recommendations</h4>
        <ul style="margin-left: 1.5rem; line-height: 2;">
          <li>${retentionRate < 50 ? '<strong>Focus on retention:</strong> ' + retentionRate + '% retention rate suggests need for re-engagement campaigns.' : '<strong>Strong retention:</strong> ' + retentionRate + '% of players return - maintain current engagement strategies.'}</li>
          <li>${topPlayerPct > 30 ? '<strong>Power user focus:</strong> Consider VIP features or rewards for top players to maintain their engagement.' : '<strong>Broad engagement:</strong> Activity is well-distributed - focus on converting one-time players.'}</li>
          <li>${scoreTrend > 5 ? '<strong>Skill improvement:</strong> Players are getting better - consider increasing difficulty or adding new challenges.' : scoreTrend < -5 ? '<strong>Difficulty adjustment:</strong> Scores declining - may need to rebalance difficulty.' : '<strong>Stable performance:</strong> Maintain current difficulty balance.'}</li>
          <li>${totalGames - totalWithLeague > totalGames * 0.1 ? '<strong>Data quality:</strong> Improve league classification to enable better analysis.' : '<strong>Data quality:</strong> League data is well-maintained.'}</li>
        </ul>
      </div>
    `;
  }
  
  // Create Users Over Time Chart with Plotly
  function createUsersOverTimeChart(data) {
    const el = document.getElementById('usersOverTimeChart');
    if (!el) return;
    
    const hourlyUsers = {};
    data.forEach(row => {
      const dateInfo = parseDate(row.Date);
      if (!dateInfo) return;
      
      const hourFloor = new Date(dateInfo.date);
      hourFloor.setMinutes(0, 0, 0);
      hourFloor.setSeconds(0, 0);
      hourFloor.setMilliseconds(0);
      const key = hourFloor.getTime();
      
      if (!hourlyUsers[key]) hourlyUsers[key] = new Set();
      if (row.Name) hourlyUsers[key].add(row.Name);
    });
    
    const sortedTimes = Object.keys(hourlyUsers).map(Number).sort((a, b) => a - b);
    const x = sortedTimes.map(t => new Date(t));
    const y = sortedTimes.map(t => hourlyUsers[t].size);
    
    const trace = {
      x: x,
      y: y,
      type: 'scatter',
      mode: 'lines',
      name: 'Unique Users',
      line: { 
        color: '#3b82f6',
        width: 2.5,
        shape: 'spline',
        smoothing: 1.3
      },
      fill: 'tozeroy',
      fillcolor: 'rgba(59, 130, 246, 0.1)',
      hovertemplate: '<b>%{fullData.name}</b><br>%{x|%b %d, %Y %I:%M %p}<br>Users: %{y}<extra></extra>'
    };
    
    const layout = {
      ...plotlyTheme,
      xaxis: { 
        ...plotlyTheme.xaxis,
        title: { text: 'Date & Time', font: { color: '#6b7280', size: 12 } }
      },
      yaxis: { 
        ...plotlyTheme.yaxis,
        title: { text: 'Unique Users', font: { color: '#6b7280', size: 12 } }
      },
      hovermode: 'x unified',
      showlegend: false
    };
    
    Plotly.newPlot(el, [trace], layout, { responsive: true, displayModeBar: true });
  }
  
  // Create League Over Time Chart with Plotly
  function createLeagueOverTimeChart(data) {
    const el = document.getElementById('leagueOverTimeChart');
    if (!el) return;
    
    const leagues = ['boulder', 'cascade', 'volcano', 'earth', 'custom'];
    const hourly = {};
    
    data.forEach(row => {
      const dateInfo = parseDate(row.Date);
      if (!dateInfo) return;
      
      const hourFloor = new Date(dateInfo.date);
      hourFloor.setMinutes(0, 0, 0);
      hourFloor.setSeconds(0, 0);
      hourFloor.setMilliseconds(0);
      const key = hourFloor.getTime();
      const league = String(row.League || '').toLowerCase();
      
      if (!hourly[key]) hourly[key] = {};
      hourly[key][league] = (hourly[key][league] || 0) + 1;
    });
    
    const sortedTimes = Object.keys(hourly).map(Number).sort((a, b) => a - b);
    const x = sortedTimes.map(t => new Date(t));
    
    const traces = leagues.map(league => ({
      x: x,
      y: sortedTimes.map(time => hourly[time][league] || 0),
      type: 'scatter',
      mode: 'lines',
      name: league.charAt(0).toUpperCase() + league.slice(1),
      line: { 
        color: colors[league] || colors.primary,
        width: 2.5,
        shape: 'spline',
        smoothing: 1.3
      },
      hovertemplate: `<b>%{fullData.name}</b><br>%{x|%b %d, %Y %I:%M %p}<br>Games: %{y}<extra></extra>`
    }));
    
    const layout = {
      ...plotlyTheme,
      xaxis: { 
        ...plotlyTheme.xaxis,
        title: { text: 'Date & Time', font: { color: '#6b7280', size: 12 } }
      },
      yaxis: { 
        ...plotlyTheme.yaxis,
        title: { text: 'Number of Games', font: { color: '#6b7280', size: 12 } }
      },
      hovermode: 'x unified'
    };
    
    Plotly.newPlot(el, traces, layout, { responsive: true, displayModeBar: true });
  }
  
  // Create League Distribution Chart
  function createLeagueDistributionChart(data) {
    const ctx = document.getElementById('leagueDistributionChart');
    if (!ctx) return;
    
    const counts = {};
    data.forEach(row => {
      const league = String(row.League || 'Unknown').toLowerCase();
      counts[league] = (counts[league] || 0) + 1;
    });
    
    const labels = Object.keys(counts);
    const values = Object.values(counts);
    const bgColors = labels.map(l => colors[l] || colors.primary);
    
    if (charts.leagueDistribution) {
      charts.leagueDistribution.data.labels = labels;
      charts.leagueDistribution.data.datasets[0].data = values;
      charts.leagueDistribution.data.datasets[0].backgroundColor = bgColors;
      charts.leagueDistribution.update('none');
    } else {
      charts.leagueDistribution = new Chart(ctx, {
        type: 'doughnut',
        data: {
          labels: labels.map(l => l.charAt(0).toUpperCase() + l.slice(1)),
          datasets: [{
            data: values,
            backgroundColor: bgColors,
            borderWidth: 0
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: true,
          plugins: {
            legend: { 
              position: 'bottom',
              labels: {
                padding: 15,
                font: { size: 12, family: 'Inter' },
                color: '#374151'
              }
            },
            tooltip: {
              backgroundColor: 'rgba(0, 0, 0, 0.8)',
              padding: 12,
              titleFont: { size: 13, weight: '600' },
              bodyFont: { size: 12 },
              borderColor: '#e5e7eb',
              borderWidth: 1
            }
          }
        }
      });
    }
  }
  
  // Create Hour Distribution Chart
  function createHourDistributionChart(data) {
    const ctx = document.getElementById('hourDistributionChart');
    if (!ctx) return;
    
    const counts = Array(24).fill(0);
    data.forEach(row => {
      const dateInfo = parseDate(row.Date);
      if (dateInfo) {
        counts[dateInfo.hour]++;
      }
    });
    
    const labels = Array.from({length: 24}, (_, i) => i + ':00');
    
    if (charts.hourDistribution) {
      charts.hourDistribution.data.datasets[0].data = counts;
      charts.hourDistribution.update('none');
    } else {
      charts.hourDistribution = new Chart(ctx, {
        type: 'bar',
        data: {
          labels,
          datasets: [{
            label: 'Games',
            data: counts,
            backgroundColor: '#3b82f6',
            borderColor: '#3b82f6',
            borderWidth: 0,
            borderRadius: 6
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: true,
          plugins: {
            legend: { display: false },
            tooltip: {
              backgroundColor: 'rgba(0, 0, 0, 0.8)',
              padding: 12
            }
          },
          scales: {
            y: {
              beginAtZero: true,
              grid: { color: '#f3f4f6' },
              ticks: { color: '#6b7280', font: { size: 11 } },
              title: { display: true, text: 'Number of Games', color: '#6b7280', font: { size: 12 } }
            },
            x: {
              grid: { display: false },
              ticks: { color: '#6b7280', font: { size: 11 } },
              title: { display: true, text: 'Hour of Day', color: '#6b7280', font: { size: 12 } }
            }
          }
        }
      });
    }
  }
  
  // Create Score vs Accuracy Scatterplot with Plotly
  function createScoreAccuracyChart(data) {
    const el = document.getElementById('scoreAccuracyChart');
    if (!el) return;
    
    const scatterData = data.filter(row => row.Score > 0 && row.Accuracy > 0);
    const leagues = ['boulder', 'cascade', 'volcano', 'earth', 'custom'];
    
    const traces = leagues.map(league => {
      const leagueData = scatterData.filter(row => 
        String(row.League || '').toLowerCase() === league
      );
      
      return {
        x: leagueData.map(d => d.Accuracy),
        y: leagueData.map(d => d.Score),
        mode: 'markers',
        type: 'scatter',
        name: league.charAt(0).toUpperCase() + league.slice(1),
        marker: {
          size: 6,
          color: colors[league] || colors.primary,
          opacity: 0.6,
          line: { width: 0 }
        },
        hovertemplate: `<b>%{fullData.name}</b><br>Accuracy: %{x}%<br>Score: %{y:,.0f}<extra></extra>`
      };
    });
    
    const layout = {
      ...plotlyTheme,
      xaxis: { 
        ...plotlyTheme.xaxis,
        title: { text: 'Accuracy (%)', font: { color: '#6b7280', size: 12 } },
        range: [0, 100]
      },
      yaxis: { 
        ...plotlyTheme.yaxis,
        title: { text: 'Score', font: { color: '#6b7280', size: 12 } }
      },
      hovermode: 'closest'
    };
    
    Plotly.newPlot(el, traces, layout, { responsive: true, displayModeBar: true });
  }
  
  // Create Score Distribution by League
  function createScoreDistributionChart(data) {
    const ctx = document.getElementById('scoreDistributionChart');
    if (!ctx) return;
    
    const leagues = ['boulder', 'cascade', 'volcano', 'earth', 'custom'];
    
    // Calculate statistics for each league
    const stats = leagues.map(league => {
      const scores = data
        .filter(row => String(row.League || '').toLowerCase() === league && row.Score > 0)
        .map(row => row.Score)
        .sort((a, b) => a - b);
      
      if (scores.length === 0) {
        return {
          league: league.charAt(0).toUpperCase() + league.slice(1),
          min: 0,
          q1: 0,
          median: 0,
          q3: 0,
          max: 0,
          avg: 0
        };
      }
      
      const q1Idx = Math.floor(scores.length * 0.25);
      const medianIdx = Math.floor(scores.length * 0.5);
      const q3Idx = Math.floor(scores.length * 0.75);
      
      return {
        league: league.charAt(0).toUpperCase() + league.slice(1),
        min: scores[0],
        q1: scores[q1Idx],
        median: scores[medianIdx],
        q3: scores[q3Idx],
        max: scores[scores.length - 1],
        avg: scores.reduce((a, b) => a + b, 0) / scores.length
      };
    });
    
    if (charts.scoreDistribution) {
      charts.scoreDistribution.data.labels = stats.map(s => s.league);
      charts.scoreDistribution.data.datasets[0].data = stats.map(s => s.avg);
      charts.scoreDistribution.data.datasets[1].data = stats.map(s => s.median);
      charts.scoreDistribution.update('none');
    } else {
      charts.scoreDistribution = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: stats.map(s => s.league),
          datasets: [
            {
              label: 'Average Score',
              data: stats.map(s => s.avg),
              backgroundColor: leagues.map(l => (colors[l] || colors.primary) + '80'),
              borderColor: leagues.map(l => colors[l] || colors.primary),
              borderWidth: 1
            },
            {
              label: 'Median Score',
              data: stats.map(s => s.median),
              backgroundColor: leagues.map(l => (colors[l] || colors.primary) + '40'),
              borderColor: leagues.map(l => colors[l] || colors.primary),
              borderWidth: 1,
              borderDash: [5, 5]
            }
          ]
        },
        options: {
          responsive: true,
          maintainAspectRatio: true,
          plugins: {
            legend: { position: 'top' },
            tooltip: {
              callbacks: {
                afterLabel: (context) => {
                  const stat = stats[context.dataIndex];
                  return `Min: ${stat.min.toLocaleString()} | Max: ${stat.max.toLocaleString()}`;
                }
              }
            }
          },
          scales: {
            y: {
              beginAtZero: true,
              title: { display: true, text: 'Score' }
            }
          }
        }
      });
    }
  }
  
  // Create League Metrics Chart
  function createLeagueMetricsChart(data) {
    const ctx = document.getElementById('leagueMetricsChart');
    if (!ctx) return;
    
    const leagues = ['boulder', 'cascade', 'volcano', 'earth', 'custom'];
    const metrics = leagues.map(league => {
      const leagueData = data.filter(row => String(row.League || '').toLowerCase() === league);
      const scores = leagueData.map(d => d.Score || 0).filter(s => s > 0);
      const accuracies = leagueData.map(d => d.Accuracy || 0).filter(a => a > 0);
      
      return {
        league: league.charAt(0).toUpperCase() + league.slice(1),
        games: leagueData.length,
        avgScore: scores.length > 0 ? scores.reduce((a, b) => a + b, 0) / scores.length : 0,
        avgAccuracy: accuracies.length > 0 ? accuracies.reduce((a, b) => a + b, 0) / accuracies.length : 0
      };
    });
    
    if (charts.leagueMetrics) {
      charts.leagueMetrics.data.datasets[0].data = metrics.map(m => m.avgScore);
      charts.leagueMetrics.data.datasets[1].data = metrics.map(m => m.avgAccuracy);
      charts.leagueMetrics.update('none');
    } else {
      charts.leagueMetrics = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: metrics.map(m => m.league),
          datasets: [
            {
              label: 'Average Score',
              data: metrics.map(m => m.avgScore),
              backgroundColor: colors.primary + '80',
              yAxisID: 'y'
            },
            {
              label: 'Average Accuracy (%)',
              data: metrics.map(m => m.avgAccuracy),
              backgroundColor: colors.success + '80',
              type: 'line',
              yAxisID: 'y1'
            }
          ]
        },
        options: {
          responsive: true,
          maintainAspectRatio: true,
          plugins: {
            legend: { position: 'top' }
          },
          scales: {
            y: {
              type: 'linear',
              position: 'left',
              title: { display: true, text: 'Average Score' },
              beginAtZero: true
            },
            y1: {
              type: 'linear',
              position: 'right',
              title: { display: true, text: 'Average Accuracy (%)' },
              beginAtZero: true,
              max: 100,
              grid: { drawOnChartArea: false }
            }
          }
        }
      });
    }
  }
  
  // Create Games Per Day Chart with Plotly
  function createGamesPerDayChart(data) {
    const el = document.getElementById('gamesPerDayChart');
    if (!el) return;
    
    const daily = {};
    data.forEach(row => {
      const dateInfo = parseDate(row.Date);
      if (!dateInfo) return;
      const key = dateInfo.dateOnly;
      daily[key] = (daily[key] || 0) + 1;
    });
    
    const sortedDates = Object.keys(daily).sort();
    const x = sortedDates.map(d => new Date(d + 'T00:00:00'));
    const y = sortedDates.map(d => daily[d]);
    
    const trace = {
      x: x,
      y: y,
      type: 'bar',
      marker: {
        color: '#3b82f6',
        line: { width: 0 }
      },
      hovertemplate: '<b>%{x|%b %d, %Y}</b><br>Games: %{y}<extra></extra>'
    };
    
    const layout = {
      ...plotlyTheme,
      xaxis: { 
        ...plotlyTheme.xaxis,
        title: { text: 'Date', font: { color: '#6b7280', size: 12 } }
      },
      yaxis: { 
        ...plotlyTheme.yaxis,
        title: { text: 'Number of Games', font: { color: '#6b7280', size: 12 } }
      },
      showlegend: false
    };
    
    Plotly.newPlot(el, [trace], layout, { responsive: true, displayModeBar: true });
  }
  
  // Create Day of Week Chart
  function createDayOfWeekChart(data) {
    const ctx = document.getElementById('dayOfWeekChart');
    if (!ctx) return;
    
    const days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
    const counts = Array(7).fill(0);
    
    data.forEach(row => {
      const dateInfo = parseDate(row.Date);
      if (dateInfo) {
        counts[dateInfo.dayOfWeek]++;
      }
    });
    
    if (charts.dayOfWeek) {
      charts.dayOfWeek.data.datasets[0].data = counts;
      charts.dayOfWeek.update('none');
    } else {
      charts.dayOfWeek = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: days,
          datasets: [{
            label: 'Games',
            data: counts,
            backgroundColor: colors.danger + '80',
            borderColor: colors.danger,
            borderWidth: 1
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: true,
          plugins: {
            legend: { display: false }
          },
          scales: {
            y: {
              beginAtZero: true,
              title: { display: true, text: 'Number of Games' }
            },
            x: {
              title: { display: true, text: 'Day of Week' }
            }
          }
        }
      });
    }
  }
  
  // Main function to update all charts
  async function updateAllCharts() {
    try {
      console.log("ðŸ”„ Fetching fresh data from Google Sheets...");
      const response = await fetch(CSV_URL);
      const csvText = await response.text();
      allData = parseCSV(csvText);
      filteredData = filterData(allData);
      
      console.log(`âœ… Loaded ${allData.length} total games (${filteredData.length} after filters)`);
      console.log(`   Raw CSV rows: ${csvText.split('\n').length - 1} (excluding header)`);
      
      // Update metrics and timestamp
      updateSummaryMetrics(filteredData);
      updateLastUpdatedTimestamp();
      
      // Wait for libraries to be ready
      if (typeof Chart === "undefined" || typeof Plotly === "undefined") {
        console.log("â³ Waiting for libraries to load...");
        setTimeout(updateAllCharts, 500);
        return;
      }
      
      // Create/update all charts with filtered data
      createUsersOverTimeChart(filteredData);
      createLeagueOverTimeChart(filteredData);
      createLeagueDistributionChart(filteredData);
      createHourDistributionChart(filteredData);
      createScoreAccuracyChart(filteredData);
      createScoreDistributionChart(filteredData);
      createLeagueMetricsChart(filteredData);
      createGamesPerDayChart(filteredData);
      createDayOfWeekChart(filteredData);
      
      // Create overview charts
      createOverviewCharts(filteredData);
      
      // Create new additional charts
      createNewReturningUsersChart(filteredData);
      createUserEngagementChart(filteredData);
      createDailyActiveUsersChart(filteredData);
      createPlayersPerLeagueChart(filteredData);
      createLeagueScoreTrendChart(filteredData);
      createLeagueAccuracyTrendChart(filteredData);
      createAccuracyDistributionChart(filteredData);
      createScoreTrendChart(filteredData);
      createScoreHistogramChart(filteredData);
      createAccuracyHistogramChart(filteredData);
      createPlayerProgressionChart(filteredData);
      createHourDayHeatmapChart(filteredData);
      createScoreByHourChart(filteredData);
      createScoreByDayChart(filteredData);
      createWeeklyPatternChart(filteredData);
      
      // Generate insights
      generateInsights(filteredData);
      
      console.log("âœ… All charts updated!");
      
    } catch (error) {
      console.error("âŒ Error loading fresh data:", error);
      document.getElementById('last-updated').innerHTML = '<strong>Error</strong>: Could not load data. Please refresh the page.';
    }
  }
  
  // Add filter event listeners
  function setupFilters() {
    const leagueFilter = document.getElementById('filter-league');
    const timeFilter = document.getElementById('filter-time');
    
    if (leagueFilter) {
      leagueFilter.addEventListener('change', () => {
        filteredData = filterData(allData);
        updateAllCharts();
      });
    }
    
    if (timeFilter) {
      timeFilter.addEventListener('change', () => {
        filteredData = filterData(allData);
        updateAllCharts();
      });
    }
  }
  
  // Initialize when page loads
  function initDashboard() {
    console.log("ðŸš€ Stunning Dashboard initializing...");
    
    // Setup navigation
    setupNavigation();
    
    // Setup filters
    setupFilters();
    
    // Wait for libraries to be ready
    function waitAndUpdate() {
      if (typeof Chart !== "undefined" && typeof Plotly !== "undefined") {
        console.log("âœ… Libraries ready, loading data...");
        updateAllCharts();
      } else {
        console.log("â³ Waiting for libraries...");
        setTimeout(waitAndUpdate, 100);
      }
    }
    
    // Start after a short delay
    setTimeout(waitAndUpdate, 500);
    
    // Update every 5 minutes
    setInterval(() => {
      console.log("â° Scheduled update (every 5 minutes)");
      updateAllCharts();
    }, 5 * 60 * 1000);
  }
  
  if (document.readyState === "loading") {
    document.addEventListener("DOMContentLoaded", initDashboard);
  } else {
    initDashboard();
  }
  
})();
</script>


<!-- -->

</section>

<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "î§‹";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb1" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "{{&lt; iconify ph house &gt;}} Overview"</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span><span class="co"> html</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co">#| include: false</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dashboardr)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="in">```{=html}</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="in">&lt;style&gt;</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="in">/* Ensure chart containers expand to fit content - aggressive overrides */</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="in">.cell-output-display,</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="in">.cell-output,</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="in">.panel-tabset-tabby &gt; .tab-content,</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="in">.panel-tabset &gt; .tab-content,</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="in">.tab-pane,</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="in">.tab-pane.active,</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="in">.card-body,</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a><span class="in">.quarto-figure,</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a><span class="in">section {</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a><span class="in">  overflow: visible !important;</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a><span class="in">  height: auto !important;</span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a><span class="in">  max-height: none !important;</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a><span class="in">/* Ensure highcharts containers respect their set height */</span></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a><span class="in">.highcharts-container,</span></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a><span class="in">.html-widget,</span></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a><span class="in">.htmlwidget {</span></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a><span class="in">  overflow: visible !important;</span></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a><span class="in">&lt;/style&gt;</span></span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a><span class="in">&lt;script&gt;</span></span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a><span class="in">// Aggressive reflow for Highcharts - multiple attempts to catch widget initialization</span></span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a><span class="in">(function() {</span></span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a><span class="in">  function reflowCharts() {</span></span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a><span class="in">    if (typeof Highcharts !== 'undefined' &amp;&amp; Highcharts.charts) {</span></span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a><span class="in">      Highcharts.charts.forEach(function(chart) {</span></span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a><span class="in">        if (chart) {</span></span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a><span class="in">          try { chart.reflow(); } catch(e) {}</span></span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a><span class="in">        }</span></span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a><span class="in">      });</span></span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a><span class="in">    }</span></span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a><span class="in">  // Try multiple times at different intervals</span></span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a><span class="in">  [0, 100, 250, 500, 1000, 2000].forEach(function(delay) {</span></span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a><span class="in">    setTimeout(function() {</span></span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a><span class="in">      window.dispatchEvent(new Event('resize'));</span></span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a><span class="in">      requestAnimationFrame(reflowCharts);</span></span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a><span class="in">    }, delay);</span></span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a><span class="in">  });</span></span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a><span class="in">  // Also reflow on any tab click</span></span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a><span class="in">  document.addEventListener('click', function(e) {</span></span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a><span class="in">    if (e.target.matches('.nav-link, [data-bs-toggle="tab"]')) {</span></span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a><span class="in">      setTimeout(reflowCharts, 50);</span></span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a><span class="in">    }</span></span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a><span class="in">  });</span></span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a><span class="in">})();</span></span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a><span class="in">&lt;/script&gt;</span></span>
<span id="cb1-65"><a href="#cb1-65" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb1-66"><a href="#cb1-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-67"><a href="#cb1-67" aria-hidden="true" tabindex="-1"></a><span class="in">```{r setup}</span></span>
<span id="cb1-68"><a href="#cb1-68" aria-hidden="true" tabindex="-1"></a><span class="in">#| echo: false</span></span>
<span id="cb1-69"><a href="#cb1-69" aria-hidden="true" tabindex="-1"></a><span class="in">#| warning: false</span></span>
<span id="cb1-70"><a href="#cb1-70" aria-hidden="true" tabindex="-1"></a><span class="in">#| message: false</span></span>
<span id="cb1-71"><a href="#cb1-71" aria-hidden="true" tabindex="-1"></a><span class="in">#| error: false</span></span>
<span id="cb1-72"><a href="#cb1-72" aria-hidden="true" tabindex="-1"></a><span class="in">#| results: 'hide'</span></span>
<span id="cb1-73"><a href="#cb1-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-74"><a href="#cb1-74" aria-hidden="true" tabindex="-1"></a><span class="in"># Load required libraries</span></span>
<span id="cb1-75"><a href="#cb1-75" aria-hidden="true" tabindex="-1"></a><span class="in">library(dashboardr)</span></span>
<span id="cb1-76"><a href="#cb1-76" aria-hidden="true" tabindex="-1"></a><span class="in">library(dplyr)</span></span>
<span id="cb1-77"><a href="#cb1-77" aria-hidden="true" tabindex="-1"></a><span class="in">library(highcharter)</span></span>
<span id="cb1-78"><a href="#cb1-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-79"><a href="#cb1-79" aria-hidden="true" tabindex="-1"></a><span class="in"># Global chunk options</span></span>
<span id="cb1-80"><a href="#cb1-80" aria-hidden="true" tabindex="-1"></a><span class="in">knitr::opts_chunk$set(</span></span>
<span id="cb1-81"><a href="#cb1-81" aria-hidden="true" tabindex="-1"></a><span class="in">  echo = FALSE,</span></span>
<span id="cb1-82"><a href="#cb1-82" aria-hidden="true" tabindex="-1"></a><span class="in">  warning = FALSE,</span></span>
<span id="cb1-83"><a href="#cb1-83" aria-hidden="true" tabindex="-1"></a><span class="in">  message = FALSE,</span></span>
<span id="cb1-84"><a href="#cb1-84" aria-hidden="true" tabindex="-1"></a><span class="in">  error = FALSE,</span></span>
<span id="cb1-85"><a href="#cb1-85" aria-hidden="true" tabindex="-1"></a><span class="in">  fig.width = 12,</span></span>
<span id="cb1-86"><a href="#cb1-86" aria-hidden="true" tabindex="-1"></a><span class="in">  fig.height = 8,</span></span>
<span id="cb1-87"><a href="#cb1-87" aria-hidden="true" tabindex="-1"></a><span class="in">  dpi = 300</span></span>
<span id="cb1-88"><a href="#cb1-88" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb1-89"><a href="#cb1-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-90"><a href="#cb1-90" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb1-91"><a href="#cb1-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-92"><a href="#cb1-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-93"><a href="#cb1-93" aria-hidden="true" tabindex="-1"></a><span class="fu"># PokÃ©mon or Drug - Game Analytics</span></span>
<span id="cb1-94"><a href="#cb1-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-95"><a href="#cb1-95" aria-hidden="true" tabindex="-1"></a>**Last Updated**: 2025-12-27 11:58:54 CET (data fetched from Google Sheets)</span>
<span id="cb1-96"><a href="#cb1-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-97"><a href="#cb1-97" aria-hidden="true" tabindex="-1"></a>Welcome to the analytics dashboard for **PokÃ©mon or Drug**!</span>
<span id="cb1-98"><a href="#cb1-98" aria-hidden="true" tabindex="-1"></a>This dashboard provides insights into game play patterns, league preferences, and player performance.</span>
<span id="cb1-99"><a href="#cb1-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-100"><a href="#cb1-100" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; **ðŸ”„ Live Data**: This dashboard automatically fetches fresh data from Google Sheets on page load and updates every 5 minutes.</span></span>
<span id="cb1-101"><a href="#cb1-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-102"><a href="#cb1-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-103"><a href="#cb1-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-104"><a href="#cb1-104" aria-hidden="true" tabindex="-1"></a>&lt;div style='height: 1rem;'&gt;&lt;/div&gt;</span>
<span id="cb1-105"><a href="#cb1-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-106"><a href="#cb1-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-107"><a href="#cb1-107" aria-hidden="true" tabindex="-1"></a><span class="in">```{=html}</span></span>
<span id="cb1-108"><a href="#cb1-108" aria-hidden="true" tabindex="-1"></a><span class="in">&lt;div class='card mb-3' style='border-left: 4px solid #2E86AB;'&gt;  &lt;div class='card-body'&gt;    &lt;div class='d-flex justify-content-between align-items-start'&gt;      &lt;div&gt;        &lt;h6 class='card-subtitle mb-2 text-muted'&gt;Total Games&lt;/h6&gt;        &lt;h2 class='card-title mb-1'&gt;1800&lt;/h2&gt;                &lt;/div&gt;      &lt;div class='text-primary'&gt;{{&lt; iconify ph:game-controller size=2em &gt;}}&lt;/div&gt;    &lt;/div&gt;  &lt;/div&gt;&lt;/div&gt;</span></span>
<span id="cb1-109"><a href="#cb1-109" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb1-110"><a href="#cb1-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-111"><a href="#cb1-111" aria-hidden="true" tabindex="-1"></a><span class="in">```{=html}</span></span>
<span id="cb1-112"><a href="#cb1-112" aria-hidden="true" tabindex="-1"></a><span class="in">&lt;div class='card mb-3' style='border-left: 4px solid #F18F01;'&gt;  &lt;div class='card-body'&gt;    &lt;div class='d-flex justify-content-between align-items-start'&gt;      &lt;div&gt;        &lt;h6 class='card-subtitle mb-2 text-muted'&gt;Unique Players&lt;/h6&gt;        &lt;h2 class='card-title mb-1'&gt;1164&lt;/h2&gt;                &lt;/div&gt;      &lt;div class='text-primary'&gt;{{&lt; iconify ph:users size=2em &gt;}}&lt;/div&gt;    &lt;/div&gt;  &lt;/div&gt;&lt;/div&gt;</span></span>
<span id="cb1-113"><a href="#cb1-113" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb1-114"><a href="#cb1-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-115"><a href="#cb1-115" aria-hidden="true" tabindex="-1"></a><span class="in">```{=html}</span></span>
<span id="cb1-116"><a href="#cb1-116" aria-hidden="true" tabindex="-1"></a><span class="in">&lt;div class='card mb-3' style='border-left: 4px solid #A23B72;'&gt;  &lt;div class='card-body'&gt;    &lt;div class='d-flex justify-content-between align-items-start'&gt;      &lt;div&gt;        &lt;h6 class='card-subtitle mb-2 text-muted'&gt;Average Score&lt;/h6&gt;        &lt;h2 class='card-title mb-1'&gt;3793&lt;/h2&gt;                &lt;/div&gt;      &lt;div class='text-primary'&gt;{{&lt; iconify ph:trophy size=2em &gt;}}&lt;/div&gt;    &lt;/div&gt;  &lt;/div&gt;&lt;/div&gt;</span></span>
<span id="cb1-117"><a href="#cb1-117" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb1-118"><a href="#cb1-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-119"><a href="#cb1-119" aria-hidden="true" tabindex="-1"></a><span class="in">```{=html}</span></span>
<span id="cb1-120"><a href="#cb1-120" aria-hidden="true" tabindex="-1"></a><span class="in">&lt;div class='card mb-3' style='border-left: 4px solid #2E8B57;'&gt;  &lt;div class='card-body'&gt;    &lt;div class='d-flex justify-content-between align-items-start'&gt;      &lt;div&gt;        &lt;h6 class='card-subtitle mb-2 text-muted'&gt;Average Accuracy&lt;/h6&gt;        &lt;h2 class='card-title mb-1'&gt;93.4%&lt;/h2&gt;                &lt;/div&gt;      &lt;div class='text-primary'&gt;{{&lt; iconify ph:target size=2em &gt;}}&lt;/div&gt;    &lt;/div&gt;  &lt;/div&gt;&lt;/div&gt;</span></span>
<span id="cb1-121"><a href="#cb1-121" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb1-122"><a href="#cb1-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-123"><a href="#cb1-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-124"><a href="#cb1-124" aria-hidden="true" tabindex="-1"></a>&lt;div style='height: 1rem;'&gt;&lt;/div&gt;</span>
<span id="cb1-125"><a href="#cb1-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-126"><a href="#cb1-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-127"><a href="#cb1-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-128"><a href="#cb1-128" aria-hidden="true" tabindex="-1"></a>&lt;script&gt;</span>
<span id="cb1-129"><a href="#cb1-129" aria-hidden="true" tabindex="-1"></a><span class="co">// Dynamic Data Loader for PokÃ©mon or Drug Analytics Dashboard</span></span>
<span id="cb1-130"><a href="#cb1-130" aria-hidden="true" tabindex="-1"></a><span class="co">// Fetches fresh data from Google Sheets and updates all Highcharts charts</span></span>
<span id="cb1-131"><a href="#cb1-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-132"><a href="#cb1-132" aria-hidden="true" tabindex="-1"></a>(<span class="kw">function</span>() {</span>
<span id="cb1-133"><a href="#cb1-133" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> CSV_URL <span class="op">=</span> <span class="st">"https://docs.google.com/spreadsheets/d/e/2PACX-1vQKvOHhK-Rw71DILu_X0ydZCS86KF2TeCyLrNAQx_MQsQN0mIPEteIO_V86DUerFO_JpwZmieGXLW-P/pub?gid=923170622&amp;single=true&amp;output=csv"</span><span class="op">;</span></span>
<span id="cb1-134"><a href="#cb1-134" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-135"><a href="#cb1-135" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Simple CSV parser</span></span>
<span id="cb1-136"><a href="#cb1-136" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">parseCSV</span>(text) {</span>
<span id="cb1-137"><a href="#cb1-137" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> lines <span class="op">=</span> text<span class="op">.</span><span class="fu">split</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)<span class="op">.</span><span class="fu">filter</span>(line <span class="kw">=&gt;</span> line<span class="op">.</span><span class="fu">trim</span>())<span class="op">;</span></span>
<span id="cb1-138"><a href="#cb1-138" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (lines<span class="op">.</span><span class="at">length</span> <span class="op">===</span> <span class="dv">0</span>) <span class="cf">return</span> []<span class="op">;</span></span>
<span id="cb1-139"><a href="#cb1-139" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-140"><a href="#cb1-140" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> headers <span class="op">=</span> lines[<span class="dv">0</span>]<span class="op">.</span><span class="fu">split</span>(<span class="st">","</span>)<span class="op">.</span><span class="fu">map</span>(h <span class="kw">=&gt;</span> h<span class="op">.</span><span class="fu">trim</span>())<span class="op">;</span></span>
<span id="cb1-141"><a href="#cb1-141" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> lines<span class="op">.</span><span class="fu">slice</span>(<span class="dv">1</span>)<span class="op">.</span><span class="fu">map</span>(line <span class="kw">=&gt;</span> {</span>
<span id="cb1-142"><a href="#cb1-142" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> values <span class="op">=</span> line<span class="op">.</span><span class="fu">split</span>(<span class="st">","</span>)<span class="op">;</span></span>
<span id="cb1-143"><a href="#cb1-143" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> obj <span class="op">=</span> {}<span class="op">;</span></span>
<span id="cb1-144"><a href="#cb1-144" aria-hidden="true" tabindex="-1"></a>      headers<span class="op">.</span><span class="fu">forEach</span>((header<span class="op">,</span> i) <span class="kw">=&gt;</span> {</span>
<span id="cb1-145"><a href="#cb1-145" aria-hidden="true" tabindex="-1"></a>        <span class="kw">let</span> value <span class="op">=</span> values[i]<span class="op">?.</span><span class="fu">trim</span>() <span class="op">||</span> <span class="st">""</span><span class="op">;</span></span>
<span id="cb1-146"><a href="#cb1-146" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Try to parse numbers</span></span>
<span id="cb1-147"><a href="#cb1-147" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (value <span class="op">&amp;&amp;</span> <span class="op">!</span><span class="pp">isNaN</span>(value) <span class="op">&amp;&amp;</span> value <span class="op">!==</span> <span class="st">""</span>) {</span>
<span id="cb1-148"><a href="#cb1-148" aria-hidden="true" tabindex="-1"></a>          obj[header] <span class="op">=</span> <span class="pp">parseFloat</span>(value)<span class="op">;</span></span>
<span id="cb1-149"><a href="#cb1-149" aria-hidden="true" tabindex="-1"></a>        } <span class="cf">else</span> {</span>
<span id="cb1-150"><a href="#cb1-150" aria-hidden="true" tabindex="-1"></a>          obj[header] <span class="op">=</span> value<span class="op">;</span></span>
<span id="cb1-151"><a href="#cb1-151" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb1-152"><a href="#cb1-152" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb1-153"><a href="#cb1-153" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> obj<span class="op">;</span></span>
<span id="cb1-154"><a href="#cb1-154" aria-hidden="true" tabindex="-1"></a>    })<span class="op">.</span><span class="fu">filter</span>(row <span class="kw">=&gt;</span> row<span class="op">.</span><span class="at">Date</span> <span class="op">&amp;&amp;</span> row<span class="op">.</span><span class="at">League</span>)<span class="op">;</span></span>
<span id="cb1-155"><a href="#cb1-155" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-156"><a href="#cb1-156" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-157"><a href="#cb1-157" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Process date</span></span>
<span id="cb1-158"><a href="#cb1-158" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">parseDate</span>(dateStr) {</span>
<span id="cb1-159"><a href="#cb1-159" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> date <span class="op">=</span> <span class="kw">new</span> <span class="bu">Date</span>(dateStr)<span class="op">;</span></span>
<span id="cb1-160"><a href="#cb1-160" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> {</span>
<span id="cb1-161"><a href="#cb1-161" aria-hidden="true" tabindex="-1"></a>      <span class="dt">date</span><span class="op">:</span> date<span class="op">,</span></span>
<span id="cb1-162"><a href="#cb1-162" aria-hidden="true" tabindex="-1"></a>      <span class="dt">dateOnly</span><span class="op">:</span> date<span class="op">.</span><span class="fu">toISOString</span>()<span class="op">.</span><span class="fu">split</span>(<span class="st">"T"</span>)[<span class="dv">0</span>]<span class="op">,</span></span>
<span id="cb1-163"><a href="#cb1-163" aria-hidden="true" tabindex="-1"></a>      <span class="dt">hour</span><span class="op">:</span> date<span class="op">.</span><span class="fu">getHours</span>()<span class="op">,</span></span>
<span id="cb1-164"><a href="#cb1-164" aria-hidden="true" tabindex="-1"></a>      <span class="dt">weekday</span><span class="op">:</span> date<span class="op">.</span><span class="fu">toLocaleDateString</span>(<span class="st">"en-US"</span><span class="op">,</span> { <span class="dt">weekday</span><span class="op">:</span> <span class="st">"long"</span> })</span>
<span id="cb1-165"><a href="#cb1-165" aria-hidden="true" tabindex="-1"></a>    }<span class="op">;</span></span>
<span id="cb1-166"><a href="#cb1-166" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-167"><a href="#cb1-167" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-168"><a href="#cb1-168" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Aggregate data for timeline (games per hour by league)</span></span>
<span id="cb1-169"><a href="#cb1-169" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">aggregateTimelineData</span>(data) {</span>
<span id="cb1-170"><a href="#cb1-170" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> hourly <span class="op">=</span> {}<span class="op">;</span></span>
<span id="cb1-171"><a href="#cb1-171" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-172"><a href="#cb1-172" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Check if data is already aggregated (has GameCount) or raw (needs counting)</span></span>
<span id="cb1-173"><a href="#cb1-173" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> isAggregated <span class="op">=</span> data<span class="op">.</span><span class="at">length</span> <span class="op">&gt;</span> <span class="dv">0</span> <span class="op">&amp;&amp;</span> data[<span class="dv">0</span>]<span class="op">.</span><span class="fu">hasOwnProperty</span>(<span class="st">"GameCount"</span>)<span class="op">;</span></span>
<span id="cb1-174"><a href="#cb1-174" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-175"><a href="#cb1-175" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (isAggregated) {</span>
<span id="cb1-176"><a href="#cb1-176" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Data is pre-aggregated: Date_Hour_Floor, League, GameCount</span></span>
<span id="cb1-177"><a href="#cb1-177" aria-hidden="true" tabindex="-1"></a>      data<span class="op">.</span><span class="fu">forEach</span>(row <span class="kw">=&gt;</span> {</span>
<span id="cb1-178"><a href="#cb1-178" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (<span class="op">!</span>row<span class="op">.</span><span class="at">Date_Hour_Floor</span> <span class="op">||</span> <span class="op">!</span>row<span class="op">.</span><span class="at">League</span>) <span class="cf">return</span><span class="op">;</span></span>
<span id="cb1-179"><a href="#cb1-179" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb1-180"><a href="#cb1-180" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> date <span class="op">=</span> <span class="kw">new</span> <span class="bu">Date</span>(row<span class="op">.</span><span class="at">Date_Hour_Floor</span>)<span class="op">;</span></span>
<span id="cb1-181"><a href="#cb1-181" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (<span class="pp">isNaN</span>(date<span class="op">.</span><span class="fu">getTime</span>())) {</span>
<span id="cb1-182"><a href="#cb1-182" aria-hidden="true" tabindex="-1"></a>          <span class="bu">console</span><span class="op">.</span><span class="fu">warn</span>(<span class="st">"Invalid date:"</span><span class="op">,</span> row<span class="op">.</span><span class="at">Date_Hour_Floor</span>)<span class="op">;</span></span>
<span id="cb1-183"><a href="#cb1-183" aria-hidden="true" tabindex="-1"></a>          <span class="cf">return</span><span class="op">;</span></span>
<span id="cb1-184"><a href="#cb1-184" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb1-185"><a href="#cb1-185" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb1-186"><a href="#cb1-186" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> key <span class="op">=</span> date<span class="op">.</span><span class="fu">getTime</span>()<span class="op">;</span></span>
<span id="cb1-187"><a href="#cb1-187" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> league <span class="op">=</span> <span class="bu">String</span>(row<span class="op">.</span><span class="at">League</span>)<span class="op">.</span><span class="fu">toLowerCase</span>()<span class="op">;</span></span>
<span id="cb1-188"><a href="#cb1-188" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb1-189"><a href="#cb1-189" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (<span class="op">!</span>hourly[key]) hourly[key] <span class="op">=</span> {}<span class="op">;</span></span>
<span id="cb1-190"><a href="#cb1-190" aria-hidden="true" tabindex="-1"></a>        hourly[key][league] <span class="op">=</span> (hourly[key][league] <span class="op">||</span> <span class="dv">0</span>) <span class="op">+</span> (row<span class="op">.</span><span class="at">GameCount</span> <span class="op">||</span> <span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb1-191"><a href="#cb1-191" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb1-192"><a href="#cb1-192" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb1-193"><a href="#cb1-193" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Raw data: need to count games per hour per league</span></span>
<span id="cb1-194"><a href="#cb1-194" aria-hidden="true" tabindex="-1"></a>      data<span class="op">.</span><span class="fu">forEach</span>(row <span class="kw">=&gt;</span> {</span>
<span id="cb1-195"><a href="#cb1-195" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (<span class="op">!</span>row<span class="op">.</span><span class="at">Date</span> <span class="op">||</span> <span class="op">!</span>row<span class="op">.</span><span class="at">League</span>) <span class="cf">return</span><span class="op">;</span></span>
<span id="cb1-196"><a href="#cb1-196" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb1-197"><a href="#cb1-197" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> date <span class="op">=</span> <span class="kw">new</span> <span class="bu">Date</span>(row<span class="op">.</span><span class="at">Date</span>)<span class="op">;</span></span>
<span id="cb1-198"><a href="#cb1-198" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (<span class="pp">isNaN</span>(date<span class="op">.</span><span class="fu">getTime</span>())) {</span>
<span id="cb1-199"><a href="#cb1-199" aria-hidden="true" tabindex="-1"></a>          <span class="bu">console</span><span class="op">.</span><span class="fu">warn</span>(<span class="st">"Invalid date:"</span><span class="op">,</span> row<span class="op">.</span><span class="at">Date</span>)<span class="op">;</span></span>
<span id="cb1-200"><a href="#cb1-200" aria-hidden="true" tabindex="-1"></a>          <span class="cf">return</span><span class="op">;</span></span>
<span id="cb1-201"><a href="#cb1-201" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb1-202"><a href="#cb1-202" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb1-203"><a href="#cb1-203" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Round down to nearest hour</span></span>
<span id="cb1-204"><a href="#cb1-204" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> hourFloor <span class="op">=</span> <span class="kw">new</span> <span class="bu">Date</span>(date)<span class="op">;</span></span>
<span id="cb1-205"><a href="#cb1-205" aria-hidden="true" tabindex="-1"></a>        hourFloor<span class="op">.</span><span class="fu">setMinutes</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb1-206"><a href="#cb1-206" aria-hidden="true" tabindex="-1"></a>        hourFloor<span class="op">.</span><span class="fu">setSeconds</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb1-207"><a href="#cb1-207" aria-hidden="true" tabindex="-1"></a>        hourFloor<span class="op">.</span><span class="fu">setMilliseconds</span>(<span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb1-208"><a href="#cb1-208" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> key <span class="op">=</span> hourFloor<span class="op">.</span><span class="fu">getTime</span>()<span class="op">;</span></span>
<span id="cb1-209"><a href="#cb1-209" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb1-210"><a href="#cb1-210" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (<span class="op">!</span>hourly[key]) hourly[key] <span class="op">=</span> {}<span class="op">;</span></span>
<span id="cb1-211"><a href="#cb1-211" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> league <span class="op">=</span> <span class="bu">String</span>(row<span class="op">.</span><span class="at">League</span>)<span class="op">.</span><span class="fu">toLowerCase</span>()<span class="op">;</span></span>
<span id="cb1-212"><a href="#cb1-212" aria-hidden="true" tabindex="-1"></a>        hourly[key][league] <span class="op">=</span> (hourly[key][league] <span class="op">||</span> <span class="dv">0</span>) <span class="op">+</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb1-213"><a href="#cb1-213" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb1-214"><a href="#cb1-214" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1-215"><a href="#cb1-215" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-216"><a href="#cb1-216" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Convert to array format for Highcharts (line chart - counts)</span></span>
<span id="cb1-217"><a href="#cb1-217" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> leagues <span class="op">=</span> [<span class="st">"boulder"</span><span class="op">,</span> <span class="st">"cascade"</span><span class="op">,</span> <span class="st">"volcano"</span><span class="op">,</span> <span class="st">"earth"</span><span class="op">,</span> <span class="st">"custom"</span>]<span class="op">;</span></span>
<span id="cb1-218"><a href="#cb1-218" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> series <span class="op">=</span> {}<span class="op">;</span></span>
<span id="cb1-219"><a href="#cb1-219" aria-hidden="true" tabindex="-1"></a>    leagues<span class="op">.</span><span class="fu">forEach</span>(league <span class="kw">=&gt;</span> series[league] <span class="op">=</span> [])<span class="op">;</span></span>
<span id="cb1-220"><a href="#cb1-220" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-221"><a href="#cb1-221" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Sort timestamps and create data points</span></span>
<span id="cb1-222"><a href="#cb1-222" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> sortedTimestamps <span class="op">=</span> <span class="bu">Object</span><span class="op">.</span><span class="fu">keys</span>(hourly)<span class="op">.</span><span class="fu">map</span>(<span class="bu">Number</span>)<span class="op">.</span><span class="fu">sort</span>((a<span class="op">,</span> b) <span class="kw">=&gt;</span> a <span class="op">-</span> b)<span class="op">;</span></span>
<span id="cb1-223"><a href="#cb1-223" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-224"><a href="#cb1-224" aria-hidden="true" tabindex="-1"></a>    sortedTimestamps<span class="op">.</span><span class="fu">forEach</span>(timestamp <span class="kw">=&gt;</span> {</span>
<span id="cb1-225"><a href="#cb1-225" aria-hidden="true" tabindex="-1"></a>      leagues<span class="op">.</span><span class="fu">forEach</span>(league <span class="kw">=&gt;</span> {</span>
<span id="cb1-226"><a href="#cb1-226" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> count <span class="op">=</span> hourly[timestamp][league] <span class="op">||</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb1-227"><a href="#cb1-227" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Include all points, even zeros, for continuity</span></span>
<span id="cb1-228"><a href="#cb1-228" aria-hidden="true" tabindex="-1"></a>        series[league]<span class="op">.</span><span class="fu">push</span>([timestamp<span class="op">,</span> count])<span class="op">;</span></span>
<span id="cb1-229"><a href="#cb1-229" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb1-230"><a href="#cb1-230" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb1-231"><a href="#cb1-231" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-232"><a href="#cb1-232" aria-hidden="true" tabindex="-1"></a>    <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">"Aggregated timeline data:"</span><span class="op">,</span> {</span>
<span id="cb1-233"><a href="#cb1-233" aria-hidden="true" tabindex="-1"></a>      <span class="dt">isAggregated</span><span class="op">:</span> isAggregated<span class="op">,</span></span>
<span id="cb1-234"><a href="#cb1-234" aria-hidden="true" tabindex="-1"></a>      <span class="dt">totalHours</span><span class="op">:</span> sortedTimestamps<span class="op">.</span><span class="at">length</span><span class="op">,</span></span>
<span id="cb1-235"><a href="#cb1-235" aria-hidden="true" tabindex="-1"></a>      <span class="dt">seriesLengths</span><span class="op">:</span> <span class="bu">Object</span><span class="op">.</span><span class="fu">keys</span>(series)<span class="op">.</span><span class="fu">map</span>(l <span class="kw">=&gt;</span> ({ </span>
<span id="cb1-236"><a href="#cb1-236" aria-hidden="true" tabindex="-1"></a>        <span class="dt">league</span><span class="op">:</span> l<span class="op">,</span> </span>
<span id="cb1-237"><a href="#cb1-237" aria-hidden="true" tabindex="-1"></a>        <span class="dt">points</span><span class="op">:</span> series[l]<span class="op">.</span><span class="at">length</span><span class="op">,</span></span>
<span id="cb1-238"><a href="#cb1-238" aria-hidden="true" tabindex="-1"></a>        <span class="dt">totalCount</span><span class="op">:</span> series[l]<span class="op">.</span><span class="fu">reduce</span>((sum<span class="op">,</span> p) <span class="kw">=&gt;</span> sum <span class="op">+</span> p[<span class="dv">1</span>]<span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb1-239"><a href="#cb1-239" aria-hidden="true" tabindex="-1"></a>      }))</span>
<span id="cb1-240"><a href="#cb1-240" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb1-241"><a href="#cb1-241" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-242"><a href="#cb1-242" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> series<span class="op">;</span></span>
<span id="cb1-243"><a href="#cb1-243" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-244"><a href="#cb1-244" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-245"><a href="#cb1-245" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Aggregate data for bar charts (count by category and group)</span></span>
<span id="cb1-246"><a href="#cb1-246" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">aggregateBarData</span>(data<span class="op">,</span> xVar<span class="op">,</span> groupVar) {</span>
<span id="cb1-247"><a href="#cb1-247" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> counts <span class="op">=</span> {}<span class="op">;</span></span>
<span id="cb1-248"><a href="#cb1-248" aria-hidden="true" tabindex="-1"></a>    data<span class="op">.</span><span class="fu">forEach</span>(row <span class="kw">=&gt;</span> {</span>
<span id="cb1-249"><a href="#cb1-249" aria-hidden="true" tabindex="-1"></a>      <span class="kw">let</span> xValue <span class="op">=</span> row[xVar]<span class="op">;</span></span>
<span id="cb1-250"><a href="#cb1-250" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (xVar <span class="op">===</span> <span class="st">"Date_Hour"</span>) xValue <span class="op">=</span> <span class="fu">parseDate</span>(row<span class="op">.</span><span class="at">Date</span>)<span class="op">.</span><span class="at">hour</span><span class="op">;</span></span>
<span id="cb1-251"><a href="#cb1-251" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (xVar <span class="op">===</span> <span class="st">"Date_Weekday"</span>) xValue <span class="op">=</span> <span class="fu">parseDate</span>(row<span class="op">.</span><span class="at">Date</span>)<span class="op">.</span><span class="at">weekday</span><span class="op">;</span></span>
<span id="cb1-252"><a href="#cb1-252" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb1-253"><a href="#cb1-253" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> group <span class="op">=</span> row[groupVar] <span class="op">||</span> <span class="st">"All"</span><span class="op">;</span></span>
<span id="cb1-254"><a href="#cb1-254" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> key <span class="op">=</span> <span class="vs">`</span><span class="sc">${</span>xValue<span class="sc">}</span><span class="vs">|</span><span class="sc">${</span>group<span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span>
<span id="cb1-255"><a href="#cb1-255" aria-hidden="true" tabindex="-1"></a>      counts[key] <span class="op">=</span> (counts[key] <span class="op">||</span> <span class="dv">0</span>) <span class="op">+</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb1-256"><a href="#cb1-256" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb1-257"><a href="#cb1-257" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-258"><a href="#cb1-258" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Organize by group</span></span>
<span id="cb1-259"><a href="#cb1-259" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> groups <span class="op">=</span> {}<span class="op">;</span></span>
<span id="cb1-260"><a href="#cb1-260" aria-hidden="true" tabindex="-1"></a>    <span class="bu">Object</span><span class="op">.</span><span class="fu">keys</span>(counts)<span class="op">.</span><span class="fu">forEach</span>(key <span class="kw">=&gt;</span> {</span>
<span id="cb1-261"><a href="#cb1-261" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> [xValue<span class="op">,</span> group] <span class="op">=</span> key<span class="op">.</span><span class="fu">split</span>(<span class="st">"|"</span>)<span class="op">;</span></span>
<span id="cb1-262"><a href="#cb1-262" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="op">!</span>groups[group]) groups[group] <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb1-263"><a href="#cb1-263" aria-hidden="true" tabindex="-1"></a>      groups[group]<span class="op">.</span><span class="fu">push</span>([xValue<span class="op">,</span> counts[key]])<span class="op">;</span></span>
<span id="cb1-264"><a href="#cb1-264" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb1-265"><a href="#cb1-265" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-266"><a href="#cb1-266" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> groups<span class="op">;</span></span>
<span id="cb1-267"><a href="#cb1-267" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-268"><a href="#cb1-268" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-269"><a href="#cb1-269" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Update timeline chart (line chart) - fix initial render and update with counts</span></span>
<span id="cb1-270"><a href="#cb1-270" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">updateTimelineChart</span>(chart<span class="op">,</span> data) {</span>
<span id="cb1-271"><a href="#cb1-271" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="op">!</span>chart) {</span>
<span id="cb1-272"><a href="#cb1-272" aria-hidden="true" tabindex="-1"></a>      <span class="bu">console</span><span class="op">.</span><span class="fu">error</span>(<span class="st">"Chart is null or undefined"</span>)<span class="op">;</span></span>
<span id="cb1-273"><a href="#cb1-273" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span><span class="op">;</span></span>
<span id="cb1-274"><a href="#cb1-274" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1-275"><a href="#cb1-275" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-276"><a href="#cb1-276" aria-hidden="true" tabindex="-1"></a>    <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">"Updating timeline chart, chart has"</span><span class="op">,</span> chart<span class="op">.</span><span class="at">series</span><span class="op">.</span><span class="at">length</span><span class="op">,</span> <span class="st">"series"</span>)<span class="op">;</span></span>
<span id="cb1-277"><a href="#cb1-277" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-278"><a href="#cb1-278" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Get count data (not percentages)</span></span>
<span id="cb1-279"><a href="#cb1-279" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> seriesData <span class="op">=</span> <span class="fu">aggregateTimelineData</span>(data)<span class="op">;</span></span>
<span id="cb1-280"><a href="#cb1-280" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> leagues <span class="op">=</span> [<span class="st">"boulder"</span><span class="op">,</span> <span class="st">"cascade"</span><span class="op">,</span> <span class="st">"volcano"</span><span class="op">,</span> <span class="st">"earth"</span><span class="op">,</span> <span class="st">"custom"</span>]<span class="op">;</span></span>
<span id="cb1-281"><a href="#cb1-281" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-282"><a href="#cb1-282" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Check if chart has existing series or if we need to recreate them</span></span>
<span id="cb1-283"><a href="#cb1-283" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (chart<span class="op">.</span><span class="at">series</span><span class="op">.</span><span class="at">length</span> <span class="op">===</span> <span class="dv">0</span>) {</span>
<span id="cb1-284"><a href="#cb1-284" aria-hidden="true" tabindex="-1"></a>      <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">"Chart has no series, creating new ones..."</span>)<span class="op">;</span></span>
<span id="cb1-285"><a href="#cb1-285" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Create new series</span></span>
<span id="cb1-286"><a href="#cb1-286" aria-hidden="true" tabindex="-1"></a>      leagues<span class="op">.</span><span class="fu">forEach</span>((league<span class="op">,</span> idx) <span class="kw">=&gt;</span> {</span>
<span id="cb1-287"><a href="#cb1-287" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> dataPoints <span class="op">=</span> seriesData[league] <span class="op">||</span> []<span class="op">;</span></span>
<span id="cb1-288"><a href="#cb1-288" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (dataPoints<span class="op">.</span><span class="at">length</span> <span class="op">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb1-289"><a href="#cb1-289" aria-hidden="true" tabindex="-1"></a>          chart<span class="op">.</span><span class="fu">addSeries</span>({</span>
<span id="cb1-290"><a href="#cb1-290" aria-hidden="true" tabindex="-1"></a>            <span class="dt">name</span><span class="op">:</span> league<span class="op">.</span><span class="fu">charAt</span>(<span class="dv">0</span>)<span class="op">.</span><span class="fu">toUpperCase</span>() <span class="op">+</span> league<span class="op">.</span><span class="fu">slice</span>(<span class="dv">1</span>)<span class="op">,</span></span>
<span id="cb1-291"><a href="#cb1-291" aria-hidden="true" tabindex="-1"></a>            <span class="dt">data</span><span class="op">:</span> dataPoints<span class="op">,</span></span>
<span id="cb1-292"><a href="#cb1-292" aria-hidden="true" tabindex="-1"></a>            <span class="dt">type</span><span class="op">:</span> <span class="st">"line"</span></span>
<span id="cb1-293"><a href="#cb1-293" aria-hidden="true" tabindex="-1"></a>          }<span class="op">,</span> <span class="kw">false</span>)<span class="op">;</span></span>
<span id="cb1-294"><a href="#cb1-294" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb1-295"><a href="#cb1-295" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb1-296"><a href="#cb1-296" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb1-297"><a href="#cb1-297" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Update existing series</span></span>
<span id="cb1-298"><a href="#cb1-298" aria-hidden="true" tabindex="-1"></a>      leagues<span class="op">.</span><span class="fu">forEach</span>((league<span class="op">,</span> idx) <span class="kw">=&gt;</span> {</span>
<span id="cb1-299"><a href="#cb1-299" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> dataPoints <span class="op">=</span> seriesData[league] <span class="op">||</span> []<span class="op">;</span></span>
<span id="cb1-300"><a href="#cb1-300" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (chart<span class="op">.</span><span class="at">series</span>[idx]) {</span>
<span id="cb1-301"><a href="#cb1-301" aria-hidden="true" tabindex="-1"></a>          chart<span class="op">.</span><span class="at">series</span>[idx]<span class="op">.</span><span class="fu">setData</span>(dataPoints<span class="op">,</span> <span class="kw">false</span>)<span class="op">;</span></span>
<span id="cb1-302"><a href="#cb1-302" aria-hidden="true" tabindex="-1"></a>          chart<span class="op">.</span><span class="at">series</span>[idx]<span class="op">.</span><span class="fu">update</span>({ <span class="dt">name</span><span class="op">:</span> league<span class="op">.</span><span class="fu">charAt</span>(<span class="dv">0</span>)<span class="op">.</span><span class="fu">toUpperCase</span>() <span class="op">+</span> league<span class="op">.</span><span class="fu">slice</span>(<span class="dv">1</span>) }<span class="op">,</span> <span class="kw">false</span>)<span class="op">;</span></span>
<span id="cb1-303"><a href="#cb1-303" aria-hidden="true" tabindex="-1"></a>        } <span class="cf">else</span> <span class="cf">if</span> (dataPoints<span class="op">.</span><span class="at">length</span> <span class="op">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb1-304"><a href="#cb1-304" aria-hidden="true" tabindex="-1"></a>          <span class="co">// Add missing series</span></span>
<span id="cb1-305"><a href="#cb1-305" aria-hidden="true" tabindex="-1"></a>          chart<span class="op">.</span><span class="fu">addSeries</span>({</span>
<span id="cb1-306"><a href="#cb1-306" aria-hidden="true" tabindex="-1"></a>            <span class="dt">name</span><span class="op">:</span> league<span class="op">.</span><span class="fu">charAt</span>(<span class="dv">0</span>)<span class="op">.</span><span class="fu">toUpperCase</span>() <span class="op">+</span> league<span class="op">.</span><span class="fu">slice</span>(<span class="dv">1</span>)<span class="op">,</span></span>
<span id="cb1-307"><a href="#cb1-307" aria-hidden="true" tabindex="-1"></a>            <span class="dt">data</span><span class="op">:</span> dataPoints<span class="op">,</span></span>
<span id="cb1-308"><a href="#cb1-308" aria-hidden="true" tabindex="-1"></a>            <span class="dt">type</span><span class="op">:</span> <span class="st">"line"</span></span>
<span id="cb1-309"><a href="#cb1-309" aria-hidden="true" tabindex="-1"></a>          }<span class="op">,</span> <span class="kw">false</span>)<span class="op">;</span></span>
<span id="cb1-310"><a href="#cb1-310" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb1-311"><a href="#cb1-311" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb1-312"><a href="#cb1-312" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1-313"><a href="#cb1-313" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-314"><a href="#cb1-314" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Ensure chart type is line (not area)</span></span>
<span id="cb1-315"><a href="#cb1-315" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (chart<span class="op">.</span><span class="at">options</span><span class="op">.</span><span class="at">chart</span> <span class="op">&amp;&amp;</span> chart<span class="op">.</span><span class="at">options</span><span class="op">.</span><span class="at">chart</span><span class="op">.</span><span class="at">type</span> <span class="op">!==</span> <span class="st">"line"</span>) {</span>
<span id="cb1-316"><a href="#cb1-316" aria-hidden="true" tabindex="-1"></a>      chart<span class="op">.</span><span class="fu">update</span>({ <span class="dt">chart</span><span class="op">:</span> { <span class="dt">type</span><span class="op">:</span> <span class="st">"line"</span> } }<span class="op">,</span> <span class="kw">false</span>)<span class="op">;</span></span>
<span id="cb1-317"><a href="#cb1-317" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1-318"><a href="#cb1-318" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-319"><a href="#cb1-319" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Update y-axis to show counts</span></span>
<span id="cb1-320"><a href="#cb1-320" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (chart<span class="op">.</span><span class="at">yAxis</span> <span class="op">&amp;&amp;</span> chart<span class="op">.</span><span class="at">yAxis</span>[<span class="dv">0</span>]) {</span>
<span id="cb1-321"><a href="#cb1-321" aria-hidden="true" tabindex="-1"></a>      chart<span class="op">.</span><span class="at">yAxis</span>[<span class="dv">0</span>]<span class="op">.</span><span class="fu">update</span>({ </span>
<span id="cb1-322"><a href="#cb1-322" aria-hidden="true" tabindex="-1"></a>        <span class="dt">title</span><span class="op">:</span> { <span class="dt">text</span><span class="op">:</span> <span class="st">"Number of Games"</span> }<span class="op">,</span></span>
<span id="cb1-323"><a href="#cb1-323" aria-hidden="true" tabindex="-1"></a>        <span class="dt">min</span><span class="op">:</span> <span class="dv">0</span></span>
<span id="cb1-324"><a href="#cb1-324" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span> <span class="kw">false</span>)<span class="op">;</span></span>
<span id="cb1-325"><a href="#cb1-325" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1-326"><a href="#cb1-326" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-327"><a href="#cb1-327" aria-hidden="true" tabindex="-1"></a>    chart<span class="op">.</span><span class="fu">redraw</span>()<span class="op">;</span></span>
<span id="cb1-328"><a href="#cb1-328" aria-hidden="true" tabindex="-1"></a>    <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">"âœ… Timeline chart updated with"</span><span class="op">,</span> data<span class="op">.</span><span class="at">length</span><span class="op">,</span> <span class="st">"games,"</span><span class="op">,</span> chart<span class="op">.</span><span class="at">series</span><span class="op">.</span><span class="at">length</span><span class="op">,</span> <span class="st">"series"</span>)<span class="op">;</span></span>
<span id="cb1-329"><a href="#cb1-329" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-330"><a href="#cb1-330" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-331"><a href="#cb1-331" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Update bar chart</span></span>
<span id="cb1-332"><a href="#cb1-332" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">updateBarChart</span>(chart<span class="op">,</span> data<span class="op">,</span> xVar<span class="op">,</span> groupVar) {</span>
<span id="cb1-333"><a href="#cb1-333" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> groups <span class="op">=</span> <span class="fu">aggregateBarData</span>(data<span class="op">,</span> xVar<span class="op">,</span> groupVar)<span class="op">;</span></span>
<span id="cb1-334"><a href="#cb1-334" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> groupNames <span class="op">=</span> <span class="bu">Object</span><span class="op">.</span><span class="fu">keys</span>(groups)<span class="op">.</span><span class="fu">sort</span>()<span class="op">;</span></span>
<span id="cb1-335"><a href="#cb1-335" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-336"><a href="#cb1-336" aria-hidden="true" tabindex="-1"></a>    groupNames<span class="op">.</span><span class="fu">forEach</span>((groupName<span class="op">,</span> idx) <span class="kw">=&gt;</span> {</span>
<span id="cb1-337"><a href="#cb1-337" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (chart<span class="op">.</span><span class="at">series</span>[idx]) {</span>
<span id="cb1-338"><a href="#cb1-338" aria-hidden="true" tabindex="-1"></a>        chart<span class="op">.</span><span class="at">series</span>[idx]<span class="op">.</span><span class="fu">setData</span>(groups[groupName] <span class="op">||</span> []<span class="op">,</span> <span class="kw">false</span>)<span class="op">;</span></span>
<span id="cb1-339"><a href="#cb1-339" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb1-340"><a href="#cb1-340" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb1-341"><a href="#cb1-341" aria-hidden="true" tabindex="-1"></a>    chart<span class="op">.</span><span class="fu">redraw</span>()<span class="op">;</span></span>
<span id="cb1-342"><a href="#cb1-342" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-343"><a href="#cb1-343" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-344"><a href="#cb1-344" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Update simple bar chart (no grouping)</span></span>
<span id="cb1-345"><a href="#cb1-345" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">updateSimpleBarChart</span>(chart<span class="op">,</span> data<span class="op">,</span> xVar) {</span>
<span id="cb1-346"><a href="#cb1-346" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> counts <span class="op">=</span> {}<span class="op">;</span></span>
<span id="cb1-347"><a href="#cb1-347" aria-hidden="true" tabindex="-1"></a>    data<span class="op">.</span><span class="fu">forEach</span>(row <span class="kw">=&gt;</span> {</span>
<span id="cb1-348"><a href="#cb1-348" aria-hidden="true" tabindex="-1"></a>      <span class="kw">let</span> value <span class="op">=</span> row[xVar]<span class="op">;</span></span>
<span id="cb1-349"><a href="#cb1-349" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (xVar <span class="op">===</span> <span class="st">"League"</span>) value <span class="op">=</span> row<span class="op">.</span><span class="at">League</span><span class="op">;</span></span>
<span id="cb1-350"><a href="#cb1-350" aria-hidden="true" tabindex="-1"></a>      counts[value] <span class="op">=</span> (counts[value] <span class="op">||</span> <span class="dv">0</span>) <span class="op">+</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb1-351"><a href="#cb1-351" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb1-352"><a href="#cb1-352" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-353"><a href="#cb1-353" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> seriesData <span class="op">=</span> <span class="bu">Object</span><span class="op">.</span><span class="fu">keys</span>(counts)<span class="op">.</span><span class="fu">map</span>(key <span class="kw">=&gt;</span> [key<span class="op">,</span> counts[key]])<span class="op">;</span></span>
<span id="cb1-354"><a href="#cb1-354" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (chart<span class="op">.</span><span class="at">series</span>[<span class="dv">0</span>]) {</span>
<span id="cb1-355"><a href="#cb1-355" aria-hidden="true" tabindex="-1"></a>      chart<span class="op">.</span><span class="at">series</span>[<span class="dv">0</span>]<span class="op">.</span><span class="fu">setData</span>(seriesData<span class="op">,</span> <span class="kw">false</span>)<span class="op">;</span></span>
<span id="cb1-356"><a href="#cb1-356" aria-hidden="true" tabindex="-1"></a>      chart<span class="op">.</span><span class="fu">redraw</span>()<span class="op">;</span></span>
<span id="cb1-357"><a href="#cb1-357" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1-358"><a href="#cb1-358" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-359"><a href="#cb1-359" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-360"><a href="#cb1-360" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Update last updated timestamp display</span></span>
<span id="cb1-361"><a href="#cb1-361" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">updateLastUpdatedTimestamp</span>() {</span>
<span id="cb1-362"><a href="#cb1-362" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> now <span class="op">=</span> <span class="kw">new</span> <span class="bu">Date</span>()<span class="op">;</span></span>
<span id="cb1-363"><a href="#cb1-363" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> formatted <span class="op">=</span> now<span class="op">.</span><span class="fu">toLocaleString</span>(<span class="st">"en-US"</span><span class="op">,</span> {</span>
<span id="cb1-364"><a href="#cb1-364" aria-hidden="true" tabindex="-1"></a>      <span class="dt">year</span><span class="op">:</span> <span class="st">"numeric"</span><span class="op">,</span></span>
<span id="cb1-365"><a href="#cb1-365" aria-hidden="true" tabindex="-1"></a>      <span class="dt">month</span><span class="op">:</span> <span class="st">"2-digit"</span><span class="op">,</span></span>
<span id="cb1-366"><a href="#cb1-366" aria-hidden="true" tabindex="-1"></a>      <span class="dt">day</span><span class="op">:</span> <span class="st">"2-digit"</span><span class="op">,</span></span>
<span id="cb1-367"><a href="#cb1-367" aria-hidden="true" tabindex="-1"></a>      <span class="dt">hour</span><span class="op">:</span> <span class="st">"2-digit"</span><span class="op">,</span></span>
<span id="cb1-368"><a href="#cb1-368" aria-hidden="true" tabindex="-1"></a>      <span class="dt">minute</span><span class="op">:</span> <span class="st">"2-digit"</span><span class="op">,</span></span>
<span id="cb1-369"><a href="#cb1-369" aria-hidden="true" tabindex="-1"></a>      <span class="dt">second</span><span class="op">:</span> <span class="st">"2-digit"</span><span class="op">,</span></span>
<span id="cb1-370"><a href="#cb1-370" aria-hidden="true" tabindex="-1"></a>      <span class="dt">timeZoneName</span><span class="op">:</span> <span class="st">"short"</span></span>
<span id="cb1-371"><a href="#cb1-371" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb1-372"><a href="#cb1-372" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-373"><a href="#cb1-373" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Update all "Last Updated" elements</span></span>
<span id="cb1-374"><a href="#cb1-374" aria-hidden="true" tabindex="-1"></a>    <span class="bu">document</span><span class="op">.</span><span class="fu">querySelectorAll</span>(<span class="st">"strong"</span>)<span class="op">.</span><span class="fu">forEach</span>(el <span class="kw">=&gt;</span> {</span>
<span id="cb1-375"><a href="#cb1-375" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (el<span class="op">.</span><span class="at">textContent</span><span class="op">.</span><span class="fu">includes</span>(<span class="st">"Last Updated"</span>)) {</span>
<span id="cb1-376"><a href="#cb1-376" aria-hidden="true" tabindex="-1"></a>        el<span class="op">.</span><span class="at">textContent</span> <span class="op">=</span> <span class="st">"Last Updated: "</span> <span class="op">+</span> formatted <span class="op">+</span> <span class="st">" (data fetched from Google Sheets)"</span><span class="op">;</span></span>
<span id="cb1-377"><a href="#cb1-377" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb1-378"><a href="#cb1-378" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb1-379"><a href="#cb1-379" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-380"><a href="#cb1-380" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Also try to find and update in parent elements</span></span>
<span id="cb1-381"><a href="#cb1-381" aria-hidden="true" tabindex="-1"></a>    <span class="bu">document</span><span class="op">.</span><span class="fu">querySelectorAll</span>(<span class="st">"p"</span>)<span class="op">.</span><span class="fu">forEach</span>(el <span class="kw">=&gt;</span> {</span>
<span id="cb1-382"><a href="#cb1-382" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (el<span class="op">.</span><span class="at">textContent</span><span class="op">.</span><span class="fu">includes</span>(<span class="st">"Last Updated"</span>)) {</span>
<span id="cb1-383"><a href="#cb1-383" aria-hidden="true" tabindex="-1"></a>        el<span class="op">.</span><span class="at">innerHTML</span> <span class="op">=</span> <span class="st">"&lt;strong&gt;Last Updated&lt;/strong&gt;: "</span> <span class="op">+</span> formatted <span class="op">+</span> <span class="st">" (data fetched from Google Sheets)"</span><span class="op">;</span></span>
<span id="cb1-384"><a href="#cb1-384" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb1-385"><a href="#cb1-385" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb1-386"><a href="#cb1-386" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-387"><a href="#cb1-387" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-388"><a href="#cb1-388" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Main function to update all charts</span></span>
<span id="cb1-389"><a href="#cb1-389" aria-hidden="true" tabindex="-1"></a>  <span class="kw">async</span> <span class="kw">function</span> <span class="fu">updateAllCharts</span>() {</span>
<span id="cb1-390"><a href="#cb1-390" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span> {</span>
<span id="cb1-391"><a href="#cb1-391" aria-hidden="true" tabindex="-1"></a>      <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">"Fetching fresh data from Google Sheets..."</span>)<span class="op">;</span></span>
<span id="cb1-392"><a href="#cb1-392" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> response <span class="op">=</span> <span class="cf">await</span> <span class="fu">fetch</span>(CSV_URL)<span class="op">;</span></span>
<span id="cb1-393"><a href="#cb1-393" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> csvText <span class="op">=</span> <span class="cf">await</span> response<span class="op">.</span><span class="fu">text</span>()<span class="op">;</span></span>
<span id="cb1-394"><a href="#cb1-394" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> freshData <span class="op">=</span> <span class="fu">parseCSV</span>(csvText)<span class="op">;</span></span>
<span id="cb1-395"><a href="#cb1-395" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb1-396"><a href="#cb1-396" aria-hidden="true" tabindex="-1"></a>      <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="vs">`Loaded </span><span class="sc">${</span>freshData<span class="op">.</span><span class="at">length</span><span class="sc">}</span><span class="vs"> games`</span>)<span class="op">;</span></span>
<span id="cb1-397"><a href="#cb1-397" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb1-398"><a href="#cb1-398" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Update last updated timestamp</span></span>
<span id="cb1-399"><a href="#cb1-399" aria-hidden="true" tabindex="-1"></a>      <span class="fu">updateLastUpdatedTimestamp</span>()<span class="op">;</span></span>
<span id="cb1-400"><a href="#cb1-400" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb1-401"><a href="#cb1-401" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Wait for Highcharts to be ready</span></span>
<span id="cb1-402"><a href="#cb1-402" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="kw">typeof</span> Highcharts <span class="op">===</span> <span class="st">"undefined"</span> <span class="op">||</span> <span class="op">!</span>Highcharts<span class="op">.</span><span class="at">charts</span>) {</span>
<span id="cb1-403"><a href="#cb1-403" aria-hidden="true" tabindex="-1"></a>        <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">"Waiting for Highcharts to load..."</span>)<span class="op">;</span></span>
<span id="cb1-404"><a href="#cb1-404" aria-hidden="true" tabindex="-1"></a>        <span class="pp">setTimeout</span>(updateAllCharts<span class="op">,</span> <span class="dv">500</span>)<span class="op">;</span></span>
<span id="cb1-405"><a href="#cb1-405" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span><span class="op">;</span></span>
<span id="cb1-406"><a href="#cb1-406" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb1-407"><a href="#cb1-407" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb1-408"><a href="#cb1-408" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Update all charts</span></span>
<span id="cb1-409"><a href="#cb1-409" aria-hidden="true" tabindex="-1"></a>      Highcharts<span class="op">.</span><span class="at">charts</span><span class="op">.</span><span class="fu">forEach</span>((chart<span class="op">,</span> idx) <span class="kw">=&gt;</span> {</span>
<span id="cb1-410"><a href="#cb1-410" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (<span class="op">!</span>chart) <span class="cf">return</span><span class="op">;</span></span>
<span id="cb1-411"><a href="#cb1-411" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb1-412"><a href="#cb1-412" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span> {</span>
<span id="cb1-413"><a href="#cb1-413" aria-hidden="true" tabindex="-1"></a>          <span class="kw">const</span> container <span class="op">=</span> chart<span class="op">.</span><span class="at">renderTo</span><span class="op">;</span></span>
<span id="cb1-414"><a href="#cb1-414" aria-hidden="true" tabindex="-1"></a>          <span class="kw">const</span> title <span class="op">=</span> chart<span class="op">.</span><span class="at">options</span><span class="op">.</span><span class="at">title</span><span class="op">?.</span><span class="at">text</span> <span class="op">||</span> <span class="st">""</span><span class="op">;</span></span>
<span id="cb1-415"><a href="#cb1-415" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb1-416"><a href="#cb1-416" aria-hidden="true" tabindex="-1"></a>          <span class="co">// Identify chart type and update accordingly</span></span>
<span id="cb1-417"><a href="#cb1-417" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (title<span class="op">.</span><span class="fu">includes</span>(<span class="st">"Over Time"</span>) <span class="op">||</span> title<span class="op">.</span><span class="fu">includes</span>(<span class="st">"Timeline"</span>) <span class="op">||</span> title<span class="op">.</span><span class="fu">includes</span>(<span class="st">"Games Played"</span>)) {</span>
<span id="cb1-418"><a href="#cb1-418" aria-hidden="true" tabindex="-1"></a>            <span class="co">// For timeline, we need to aggregate fresh data by hour</span></span>
<span id="cb1-419"><a href="#cb1-419" aria-hidden="true" tabindex="-1"></a>            <span class="fu">updateTimelineChart</span>(chart<span class="op">,</span> freshData)<span class="op">;</span></span>
<span id="cb1-420"><a href="#cb1-420" aria-hidden="true" tabindex="-1"></a>          } <span class="cf">else</span> <span class="cf">if</span> (title<span class="op">.</span><span class="fu">includes</span>(<span class="st">"Hour"</span>) <span class="op">&amp;&amp;</span> <span class="op">!</span>title<span class="op">.</span><span class="fu">includes</span>(<span class="st">"Over Time"</span>)) {</span>
<span id="cb1-421"><a href="#cb1-421" aria-hidden="true" tabindex="-1"></a>            <span class="co">// Bar chart for hour of day (not timeline)</span></span>
<span id="cb1-422"><a href="#cb1-422" aria-hidden="true" tabindex="-1"></a>            <span class="fu">updateBarChart</span>(chart<span class="op">,</span> freshData<span class="op">,</span> <span class="st">"Date_Hour"</span><span class="op">,</span> <span class="st">"League"</span>)<span class="op">;</span></span>
<span id="cb1-423"><a href="#cb1-423" aria-hidden="true" tabindex="-1"></a>          } <span class="cf">else</span> <span class="cf">if</span> (title<span class="op">.</span><span class="fu">includes</span>(<span class="st">"Day of Week"</span>) <span class="op">||</span> title<span class="op">.</span><span class="fu">includes</span>(<span class="st">"Weekday"</span>)) {</span>
<span id="cb1-424"><a href="#cb1-424" aria-hidden="true" tabindex="-1"></a>            <span class="fu">updateBarChart</span>(chart<span class="op">,</span> freshData<span class="op">,</span> <span class="st">"Date_Weekday"</span><span class="op">,</span> <span class="st">"League"</span>)<span class="op">;</span></span>
<span id="cb1-425"><a href="#cb1-425" aria-hidden="true" tabindex="-1"></a>          } <span class="cf">else</span> <span class="cf">if</span> (title<span class="op">.</span><span class="fu">includes</span>(<span class="st">"Total Games by League"</span>)) {</span>
<span id="cb1-426"><a href="#cb1-426" aria-hidden="true" tabindex="-1"></a>            <span class="fu">updateSimpleBarChart</span>(chart<span class="op">,</span> freshData<span class="op">,</span> <span class="st">"League"</span>)<span class="op">;</span></span>
<span id="cb1-427"><a href="#cb1-427" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb1-428"><a href="#cb1-428" aria-hidden="true" tabindex="-1"></a>        } <span class="cf">catch</span> (error) {</span>
<span id="cb1-429"><a href="#cb1-429" aria-hidden="true" tabindex="-1"></a>          <span class="bu">console</span><span class="op">.</span><span class="fu">warn</span>(<span class="vs">`Error updating chart </span><span class="sc">${</span>idx<span class="sc">}</span><span class="vs">:`</span><span class="op">,</span> error)<span class="op">;</span></span>
<span id="cb1-430"><a href="#cb1-430" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb1-431"><a href="#cb1-431" aria-hidden="true" tabindex="-1"></a>      })<span class="op">;</span></span>
<span id="cb1-432"><a href="#cb1-432" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb1-433"><a href="#cb1-433" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Update summary metrics if they exist</span></span>
<span id="cb1-434"><a href="#cb1-434" aria-hidden="true" tabindex="-1"></a>      <span class="fu">updateSummaryMetrics</span>(freshData)<span class="op">;</span></span>
<span id="cb1-435"><a href="#cb1-435" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb1-436"><a href="#cb1-436" aria-hidden="true" tabindex="-1"></a>      <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">"âœ… Charts updated with fresh data!"</span>)<span class="op">;</span></span>
<span id="cb1-437"><a href="#cb1-437" aria-hidden="true" tabindex="-1"></a>      <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">"   Updated"</span><span class="op">,</span> Highcharts<span class="op">.</span><span class="at">charts</span><span class="op">.</span><span class="fu">filter</span>(c <span class="kw">=&gt;</span> c)<span class="op">.</span><span class="at">length</span><span class="op">,</span> <span class="st">"charts"</span>)<span class="op">;</span></span>
<span id="cb1-438"><a href="#cb1-438" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb1-439"><a href="#cb1-439" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">catch</span> (error) {</span>
<span id="cb1-440"><a href="#cb1-440" aria-hidden="true" tabindex="-1"></a>      <span class="bu">console</span><span class="op">.</span><span class="fu">error</span>(<span class="st">"âŒ Error loading fresh data:"</span><span class="op">,</span> error)<span class="op">;</span></span>
<span id="cb1-441"><a href="#cb1-441" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1-442"><a href="#cb1-442" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-443"><a href="#cb1-443" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-444"><a href="#cb1-444" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Update summary metrics</span></span>
<span id="cb1-445"><a href="#cb1-445" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">updateSummaryMetrics</span>(data) {</span>
<span id="cb1-446"><a href="#cb1-446" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> totalGames <span class="op">=</span> data<span class="op">.</span><span class="at">length</span><span class="op">;</span></span>
<span id="cb1-447"><a href="#cb1-447" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> uniquePlayers <span class="op">=</span> <span class="kw">new</span> <span class="bu">Set</span>(data<span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">Name</span>))<span class="op">.</span><span class="at">size</span><span class="op">;</span></span>
<span id="cb1-448"><a href="#cb1-448" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> avgScore <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">round</span>(data<span class="op">.</span><span class="fu">reduce</span>((sum<span class="op">,</span> d) <span class="kw">=&gt;</span> sum <span class="op">+</span> (d<span class="op">.</span><span class="at">Score</span> <span class="op">||</span> <span class="dv">0</span>)<span class="op">,</span> <span class="dv">0</span>) <span class="op">/</span> totalGames)<span class="op">;</span></span>
<span id="cb1-449"><a href="#cb1-449" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> avgAccuracy <span class="op">=</span> (data<span class="op">.</span><span class="fu">reduce</span>((sum<span class="op">,</span> d) <span class="kw">=&gt;</span> sum <span class="op">+</span> (d<span class="op">.</span><span class="at">Accuracy</span> <span class="op">||</span> <span class="dv">0</span>)<span class="op">,</span> <span class="dv">0</span>) <span class="op">/</span> totalGames)<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb1-450"><a href="#cb1-450" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-451"><a href="#cb1-451" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Try to update metric elements (adjust selectors based on actual structure)</span></span>
<span id="cb1-452"><a href="#cb1-452" aria-hidden="true" tabindex="-1"></a>    <span class="bu">document</span><span class="op">.</span><span class="fu">querySelectorAll</span>(<span class="st">".metric-value, [class*="</span>value<span class="st">"]"</span>)<span class="op">.</span><span class="fu">forEach</span>((el<span class="op">,</span> idx) <span class="kw">=&gt;</span> {</span>
<span id="cb1-453"><a href="#cb1-453" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> values <span class="op">=</span> [totalGames<span class="op">,</span> uniquePlayers<span class="op">,</span> avgScore<span class="op">,</span> avgAccuracy <span class="op">+</span> <span class="st">"%"</span>]<span class="op">;</span></span>
<span id="cb1-454"><a href="#cb1-454" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (values[idx]) {</span>
<span id="cb1-455"><a href="#cb1-455" aria-hidden="true" tabindex="-1"></a>        el<span class="op">.</span><span class="at">textContent</span> <span class="op">=</span> values[idx]<span class="op">;</span></span>
<span id="cb1-456"><a href="#cb1-456" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb1-457"><a href="#cb1-457" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb1-458"><a href="#cb1-458" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-459"><a href="#cb1-459" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-460"><a href="#cb1-460" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Initialize when page loads</span></span>
<span id="cb1-461"><a href="#cb1-461" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">initDynamicUpdates</span>() {</span>
<span id="cb1-462"><a href="#cb1-462" aria-hidden="true" tabindex="-1"></a>    <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">"ðŸ”„ Dynamic data loader initialized"</span>)<span class="op">;</span></span>
<span id="cb1-463"><a href="#cb1-463" aria-hidden="true" tabindex="-1"></a>    <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">"   Will fetch fresh data from:"</span><span class="op">,</span> CSV_URL)<span class="op">;</span></span>
<span id="cb1-464"><a href="#cb1-464" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-465"><a href="#cb1-465" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Wait for Highcharts to be ready, then update</span></span>
<span id="cb1-466"><a href="#cb1-466" aria-hidden="true" tabindex="-1"></a>    <span class="kw">function</span> <span class="fu">waitAndUpdate</span>() {</span>
<span id="cb1-467"><a href="#cb1-467" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="kw">typeof</span> Highcharts <span class="op">!==</span> <span class="st">"undefined"</span> <span class="op">&amp;&amp;</span> Highcharts<span class="op">.</span><span class="at">charts</span> <span class="op">&amp;&amp;</span> Highcharts<span class="op">.</span><span class="at">charts</span><span class="op">.</span><span class="at">length</span> <span class="op">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb1-468"><a href="#cb1-468" aria-hidden="true" tabindex="-1"></a>        <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">"   Highcharts ready, updating charts..."</span>)<span class="op">;</span></span>
<span id="cb1-469"><a href="#cb1-469" aria-hidden="true" tabindex="-1"></a>        <span class="fu">updateAllCharts</span>()<span class="op">;</span></span>
<span id="cb1-470"><a href="#cb1-470" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb1-471"><a href="#cb1-471" aria-hidden="true" tabindex="-1"></a>        <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">"   Waiting for Highcharts..."</span>)<span class="op">;</span></span>
<span id="cb1-472"><a href="#cb1-472" aria-hidden="true" tabindex="-1"></a>        <span class="pp">setTimeout</span>(waitAndUpdate<span class="op">,</span> <span class="dv">500</span>)<span class="op">;</span></span>
<span id="cb1-473"><a href="#cb1-473" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb1-474"><a href="#cb1-474" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1-475"><a href="#cb1-475" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-476"><a href="#cb1-476" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Start checking after a short delay</span></span>
<span id="cb1-477"><a href="#cb1-477" aria-hidden="true" tabindex="-1"></a>    <span class="pp">setTimeout</span>(waitAndUpdate<span class="op">,</span> <span class="dv">1500</span>)<span class="op">;</span></span>
<span id="cb1-478"><a href="#cb1-478" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-479"><a href="#cb1-479" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Also update every 5 minutes</span></span>
<span id="cb1-480"><a href="#cb1-480" aria-hidden="true" tabindex="-1"></a>    <span class="pp">setInterval</span>(<span class="kw">function</span>() {</span>
<span id="cb1-481"><a href="#cb1-481" aria-hidden="true" tabindex="-1"></a>      <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(<span class="st">"â° Scheduled update (every 5 minutes)"</span>)<span class="op">;</span></span>
<span id="cb1-482"><a href="#cb1-482" aria-hidden="true" tabindex="-1"></a>      <span class="fu">updateAllCharts</span>()<span class="op">;</span></span>
<span id="cb1-483"><a href="#cb1-483" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span> <span class="dv">5</span> <span class="op">*</span> <span class="dv">60</span> <span class="op">*</span> <span class="dv">1000</span>)<span class="op">;</span></span>
<span id="cb1-484"><a href="#cb1-484" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-485"><a href="#cb1-485" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-486"><a href="#cb1-486" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="bu">document</span><span class="op">.</span><span class="at">readyState</span> <span class="op">===</span> <span class="st">"loading"</span>) {</span>
<span id="cb1-487"><a href="#cb1-487" aria-hidden="true" tabindex="-1"></a>    <span class="bu">document</span><span class="op">.</span><span class="fu">addEventListener</span>(<span class="st">"DOMContentLoaded"</span><span class="op">,</span> initDynamicUpdates)<span class="op">;</span></span>
<span id="cb1-488"><a href="#cb1-488" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb1-489"><a href="#cb1-489" aria-hidden="true" tabindex="-1"></a>    <span class="fu">initDynamicUpdates</span>()<span class="op">;</span></span>
<span id="cb1-490"><a href="#cb1-490" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-491"><a href="#cb1-491" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-492"><a href="#cb1-492" aria-hidden="true" tabindex="-1"></a>})()<span class="op">;</span></span>
<span id="cb1-493"><a href="#cb1-493" aria-hidden="true" tabindex="-1"></a>&lt;/script&gt;</span>
<span id="cb1-494"><a href="#cb1-494" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-495"><a href="#cb1-495" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-496"><a href="#cb1-496" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-497"><a href="#cb1-497" aria-hidden="true" tabindex="-1"></a>::: {.callout-tip}</span>
<span id="cb1-498"><a href="#cb1-498" aria-hidden="true" tabindex="-1"></a><span class="fu">## What's Inside</span></span>
<span id="cb1-499"><a href="#cb1-499" aria-hidden="true" tabindex="-1"></a>Explore the dashboard to see:</span>
<span id="cb1-500"><a href="#cb1-500" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-501"><a href="#cb1-501" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Games Over Time**: Daily trends and hourly patterns</span>
<span id="cb1-502"><a href="#cb1-502" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**League Analysis**: Performance metrics by difficulty level</span>
<span id="cb1-503"><a href="#cb1-503" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Player Insights**: Score distributions and accuracy trends</span>
<span id="cb1-504"><a href="#cb1-504" aria-hidden="true" tabindex="-1"></a>:::</span>
</code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
<p>Â© 2025 PokÃ©mon or Drug - Built with dashboardr</p>
<div class="toc-actions"><ul><li><a href="https://github.com/favstats/pokemon-or-drug/edit/main/index.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/favstats/pokemon-or-drug/blob/main/index.qmd" class="toc-action"><i class="bi empty"></i>View source</a></li><li><a href="https://github.com/favstats/pokemon-or-drug/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>